<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover" />
  <title>é˜¿è¨˜ä¸‰ç¼ºä¸€</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="é˜¿è¨˜å¨›æ¨‚åŸ">

  <meta name="mobile-web-app-capable" content="yes">
  <style>
    :root {
      --gold: #ffd86b;
      --dark-red: #4a0404;
      --card-bg: rgba(255, 255, 255, 0.1);
      --red: #ff4757;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      /* é—œéµï¼šåœ¨æœ€åº•å±¤å°±çµ¦é»‘è‰²ï¼Œé˜²æ­¢ä»»ä½•å½ˆè·³éœ²ç™½ */
      background-color: #050000;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at center, #2a0202, #050000);
      color: #fff;
      font-family: "Microsoft JhengHei", Arial;
      height: 100dvh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    #welcomeUserContainer.rank-item {
      display: inline-block;
      padding: 5px 15px;
      margin-top: 5px;
      border-radius: 20px;
    }

    /* é€šç”¨é …ç›®æ¨£å¼ */
    .rank-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.2s;
    }

    .buy-btn {
      background: #3b82f6;
      border: none;
      color: white;
      padding: 5px 15px;
      border-radius: 5px;
      font-weight: bold;
    }

    .equip-btn {
      background: #10b981;
      border: none;
      color: white;
      padding: 5px 15px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }

    /* å‘¼å¸ç‡ˆå‹•ç•«ï¼šé™°å½±èˆ‡äº®åº¦çš„å¼·å¼±è®ŠåŒ– */
    @keyframes breathing-glow {
      0% {
        box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
        filter: brightness(1);
      }

      50% {
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
        filter: brightness(1.3);
        /* è®Šäº® */
      }

      100% {
        box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
        filter: brightness(1);
      }
    }

    /* è£å‚™æŒ‰éˆ•æ¨£å¼ */
    .equip-btn {
      background: #10b981;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      font-size: 12px;
    }

    .buy-btn {
      background: #3b82f6;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      font-size: 12px;
    }

    /* ç¨±è™ŸåŸºç¤æ¨£å¼ */
    .player-title {
      font-weight: 900;
      margin-right: 5px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }

    /* ç¨±è™Ÿç­‰ç´šè‰²å½© */
    .t-green {
      color: #2ecc71 !important;
    }

    /* åˆç´š */
    .t-blue {
      color: #3498db !important;
    }

    /* ä¸­ç´š */
    .t-purple {
      color: #9b59b6 !important;
    }

    .t-yellow {
      color: #ffd000 !important;
    }

    /* é«˜ç´š */
    .t-orange {
      color: #e67e22 !important;
    }

    /* å‚³å¥‡ */
    .t-red {
      color: #ff4757 !important;
      animation: title-glow 1s infinite alternate;
    }

    /* ç¥è©± */

    @keyframes title-glow {
      from {
        filter: drop-shadow(0 0 1px #ff4757);
      }

      to {
        filter: drop-shadow(0 0 5px #ff4757);
      }
    }

    .welcome-msg {
      position: relative;
      overflow: hidden;
      /* ç¢ºä¿ç‰¹æ•ˆä¸æœƒè¶…å‡ºåœ“è§’é‚Šæ¡† */
      z-index: 1;
    }

    /* --- ç‰¹æ•ˆ 1ï¼šæ¥µé™ç„ç« (éœ‡å‹• + ç†”å²©æµ) --- */
    .welcome-msg,
    .rank-item {
      position: relative !important;
      overflow: hidden !important;
      /* åš´æ ¼ç¦æ­¢å…§å®¹æº¢å‡º */
      contain: paint;
      /* é€™æ˜¯é˜²æ­¢æ©«å‘æ²è»¸çš„æœ€å¼·æ‰‹æ®µ */
      z-index: 1;
    }

    /* --- ç‰¹æ•ˆ 1ï¼šç„ç«ç„šèº« (ä¿®æ­£éœ‡å‹•ï¼Œé˜²æ­¢æ©«æ¢) --- */
    .fx-fire {
      /* é‚Šæ¡†æ”¹ç”¨æ¼¸å±¤è‰²ï¼Œæ¨¡æ“¬ç™¼ç†±çš„é‡‘å±¬ */
      border: 2px solid transparent !important;
      background:
        linear-gradient(#2a0000, #2a0000) padding-box,
        /* å…§å®¹èƒŒæ™¯ */
        linear-gradient(0deg, #ff4757, #ff9f43, #ff4757) border-box !important;
      /* é‚Šæ¡†ç«ç„°æµ */
      background-size: 100% 100%, 100% 300% !important;
      color: #fff !important;
      box-shadow: inset 0 0 15px #741b1b, 0 0 15px rgba(255, 71, 87, 0.5) !important;
      text-shadow: 0 0 8px #ff4757, 0 0 15px #ff7e67 !important;
      /* border-flow è®“é‚Šæ¡†é¡è‰²ç«„å‹•, fire-flicker è®“æ•´é«”é–ƒçˆ */
      animation:
        fire-flicker 0.2s ease-in-out infinite alternate,
        border-flow 1.5s linear infinite !important;
    }

    .fx-fire::before {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 200%;
      /* æ¨¡æ“¬å‘ä¸Šç«„çš„ç«è‹—æ¼¸å±¤ */
      background: linear-gradient(0deg,
          transparent 0%,
          rgba(255, 69, 0, 0.4) 20%,
          rgba(255, 165, 0, 0.2) 50%,
          transparent 80%);
      z-index: -1;
      animation: fire-rise 1s linear infinite;
      /* ç«è‹—å‘ä¸Šç«„å‹• */
    }

    /* [ç‰¹æ•ˆï¼šé›·éœ†éœ“è™¹] */
    .fx-neon {
      border: 2px solid #fff !important;
      /* 1. é—œéµä¿®æ”¹ï¼šå°‡ 0% å’Œ 100% çš„é»‘è‰²æ”¹ç‚ºæ·±è—è‰²ï¼Œhue-rotate æ‰èƒ½æŠ“åˆ°é¡è‰²è®Šè‰² */
      background: linear-gradient(135deg,
          #001a33 0%,
          /* å–ä»£é»‘è‰² */
          #004488 25%,
          #0066aa 50%,
          #440088 75%,
          #001a33 100%
          /* å–ä»£é»‘è‰² */
        ) !important;
      background-size: 300% 300% !important;
      color: #fff !important;

      /* 2. å¢åŠ å¼·çƒˆçš„å…§éƒ¨ç™¼å…‰ï¼Œç›´æ¥æŠŠèƒŒæ™¯ç…§äº® */
      box-shadow:
        inset 0 0 30px rgba(0, 210, 255, 0.7),
        0 0 10px #fff,
        0 0 20px #00d2ff !important;

      /* 3. å‹•ç•«çµ„åˆ */
      animation:
        neon-flicker 2s infinite,
        neon-rainbow 2s linear infinite,
        bg-flow-extreme 1s ease-in-out infinite !important;

      /* ç¢ºä¿å…§å®¹åœ¨ç™¼å…‰èƒŒæ™¯ä¸Šä¾ç„¶æ¸…æ™° */
      text-shadow: 0 0 5px #000, 2px 2px 2px #000 !important;
    }

    /* 4. å¼·åŒ–çš„èƒŒæ™¯ç§»å‹•ï¼šè®“æ¼¸å±¤åœ¨ç›’å­è£¡å¤§å¹…åº¦æ»‘å‹• */
    @keyframes bg-flow-extreme {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    /* --- ç‰¹æ•ˆ 3ï¼šè‡³å°Šçš‡é‡‘ (ä¿æŒç°¡æ½”é«˜ç´šæ„Ÿ) --- */
    .fx-gold {
      border: 1px solid #ffd700 !important;
      background-image: linear-gradient(110deg, #6b5500 0%, #ffd700 50%, #6b5500 100%) !important;
      background-size: 200% auto !important;
      color: #fff !important;
      animation: shine-gold 3s linear infinite !important;
    }

    /* --- å‹•ç•«ä¿®æ­£å®šç¾© --- */
    @keyframes fire-pulse {
      from {
        filter: brightness(1);
        box-shadow: 0 0 10px #ff4757;
      }

      to {
        filter: brightness(1.5);
        box-shadow: 0 0 20px #ff4757;
      }
    }

    @keyframes fire-swirl {
      0% {
        transform: rotate(0deg) scale(1);
      }

      50% {
        transform: rotate(180deg) scale(1.1);
      }

      100% {
        transform: rotate(360deg) scale(1);
      }
    }

    @keyframes border-flow {
      0% {
        background-position: 0% 0%, 50% 100%;
      }

      100% {
        background-position: 0% 0%, 50% -100%;
      }
    }

    /* ç«èˆŒå‘ä¸Šå‡é¨° */
    @keyframes fire-rise {
      0% {
        transform: translateY(0%);
        opacity: 0.8;
      }

      100% {
        transform: translateY(-50%);
        opacity: 0.4;
      }
    }

    @keyframes fire-flicker {
      0% {
        filter: brightness(1);
      }

      100% {
        filter: brightness(1.3);
      }
    }

    /* éœ“è™¹æé‚Šæµå‹• */
    @keyframes neon-trace {
      0% {
        clip-path: inset(0 70% 95% 0);
      }

      25% {
        clip-path: inset(0 0 70% 95%);
      }

      50% {
        clip-path: inset(95% 0 0 70%);
      }

      75% {
        clip-path: inset(70% 95% 0 0);
      }

      100% {
        clip-path: inset(0 70% 95% 0);
      }
    }

    @keyframes neon-rainbow {
      0% {
        filter: hue-rotate(0deg);
      }

      100% {
        filter: hue-rotate(360deg);
      }
    }

    /* éœ“è™¹ï¼šåŸæœ¬çš„é–ƒçˆæ•ˆæœ */
    @keyframes neon-flicker {

      0%,
      18%,
      22%,
      25%,
      53%,
      57%,
      100% {
        text-shadow: 0 0 10px #fff, 0 0 20px #00d2ff;
        opacity: 1;
      }

      20%,
      24%,
      55% {
        text-shadow: none;
        box-shadow: none;
        opacity: 0.7;
      }
    }

    @keyframes shine-gold {
      to {
        background-position: 200% center;
      }
    }

    @keyframes rotate-slow {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    @keyframes void-pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(0.97);
      }

      /* ç¨å¾®ç¸®å°æ¨¡æ“¬è¢«å¸å…¥ */
    }

    @keyframes breathing-glow {

      0%,
      100% {
        filter: brightness(1);
      }

      50% {
        filter: brightness(1.4);
      }
    }

    /* --- ç‰¹æ•ˆ 4ï¼šçµ•å°é›¶åº¦ (å†°è—å‘¼å¸ + çµæ™¶é–ƒçˆ) --- */
    .fx-ice {
      position: relative;
      overflow: hidden;
      border: 1px solid #00f2fe !important;
      background: linear-gradient(135deg, #005f73, #00d4ff) !important;
      color: #fff !important;
      text-shadow: 0 0 10px #7ed6ff !important;
      box-shadow: 0 0 15px rgba(0, 242, 254, 0.5) !important;
      animation: ice-shimmer 2s ease-in-out infinite alternate !important;
    }

    /* â„ï¸ é€™è£¡æ˜¯é›ªèŠ±å°ˆå±¬å±¤ */
    .fx-ice::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;

      /* ä½¿ç”¨ä¸‰å±¤éš¨æ©Ÿåˆ†ä½ˆçš„é›ªèŠ±é» */
      background-image:
        radial-gradient(1.5px 1.5px at 20% 30%, #fff 100%, transparent),
        radial-gradient(2px 2px at 50% 70%, #fff 100%, transparent),
        radial-gradient(1.2px 1.2px at 80% 40%, #fff 100%, transparent);

      /* è®“é›ªèŠ±èƒŒæ™¯é‡è¤‡é‹ªæ»¿ï¼Œä¸¦è¨­å®šä¸åŒçš„å¤§å°ä¾†æ‰“ç ´è¦å¾‹ */
      background-size: 100px 100px, 150px 150px, 200px 200px;

      /* åŸ·è¡Œä¸‹é›ªå‹•ç•« */
      animation: snow-fall-fixed 10s linear infinite;
    }

    .fx-ice::before {
      content: "â„" !important;
      color: #6860fe !important;
      text-shadow: 0 0 5px rgba(237, 159, 255, 0.8) !important;
      position: absolute;
      right: 5px;
      top: -5px;
      opacity: 1;
      font-size: 20px;
      animation: rotate-slow 5s linear infinite;
    }

    @keyframes snow-fall-fixed {
      0% {
        background-position: 0 0, 0 0, 0 0;
      }

      100% {
        /* è®“ä¸‰å±¤é›ªèŠ±ä»¥ä¸åŒé€Ÿåº¦å’Œæ–¹å‘é£„è½ï¼Œè¦–è¦ºä¸Šå¾ˆéš¨æ©Ÿ */
        background-position: 100px 100px, -150px 300px, 200px 600px;
      }
    }

    /* --- ç‰¹æ•ˆ 5ï¼šæ·±æµ·é›·é³´ (æ·±è—èƒŒæ™¯ + éš¨æ©Ÿé–ƒé›») --- */
    .fx-thunder {
      border: 1px solid #4834d4 !important;
      background: #060b28 !important;
      color: #fff !important;
      overflow: hidden;
    }

    .fx-thunder::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0;
      z-index: -1;
      animation: lightning-strike 2s steps(1) infinite;
    }

    /* --- ç‰¹æ•ˆ 6ï¼šé»‘æ´æ¹®æ»… (æš—ç´«è‰²é‚Šæ¡† + ç©ºé–“æ‰­æ›²æ„Ÿ) --- */
    .fx-void {
      border: 2px solid #2f3542 !important;
      background: black !important;
      color: #a55eea !important;
      box-shadow: 0 0 20px #6c5ce7 !important;
      animation: void-pulse 3s ease-in-out infinite !important;
    }

    .fx-void::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(from 0deg, transparent, #6c5ce7, transparent);
      animation: rotate-slow 3s linear infinite;
      z-index: -1;
      opacity: 0.4;
    }

    /* --- ç‰¹æ•ˆ 7ï¼šé§­å®¢ä»»å‹™ (çœŸÂ·çŸ©é™£ä»£ç¢¼é›¨ - ç„¡é™å¾ªç’°ä¿®å¾©) --- */
    .fx-hacker {
      position: relative !important;
      background: #000 !important;
      border: 2px solid #0f0 !important;
      color: #0f0 !important;
      font-family: 'Courier New', monospace;
      overflow: hidden !important;
      box-shadow: 0 0 15px #0f0, inset 0 0 30px rgba(0, 255, 0, 0.4) !important;
      z-index: 1;
    }

    /* 1. èƒŒæ™¯æ¢ç´‹ */
    .fx-hacker::before {
      content: "";
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(0deg,
          transparent,
          transparent 2px,
          rgba(0, 255, 0, 0.1) 2px,
          rgba(0, 255, 0, 0.1) 4px);
      z-index: -1;
    }

    /* 2. äº‚ç¢¼ç€‘å¸ƒæµ - åŠ é•·å…§å®¹ç¢ºä¿å¾ªç’°ä¸æ–· */
    .fx-hacker::after {
      content: "10110010101010010101101010101001010101010101010010110101001010110101010010101101010010101010101010010010110100101010100101010101010100101101010010101101010100101011010100101010101010101001\A 0101010101010101010101010010101010101010110101010010101010100101010101010010101010010110101001010101\A 1101010100101011010100101010101010100101101010010101010010101101010101001001010110101010101001\A 1011001010101001010110101010100101010101010101001011010100101011010101001010110101001010101010101001001011010010101010010101010101010010110101001010110101010010101101010010101010101010101001";
      position: absolute;
      top: -100%;
      left: 0;
      width: 100%;
      height: 300%;
      /* å¢åŠ é«˜åº¦ */
      font-size: 12px;
      line-height: 12px;
      word-break: break-all;
      white-space: pre-wrap;
      color: rgba(0, 255, 0, 0.3);
      animation: matrix-scroll 4s linear infinite;
      z-index: -1;
    }

    @keyframes matrix-scroll {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(50%);
      }

      /* æ§åˆ¶ç§»å‹•ç¯„åœ */
    }

    @keyframes matrix-bg-scroll {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(-20px);
      }
    }

    @keyframes scanline-pass {
      0% {
        top: -20%;
      }

      100% {
        top: 120%;
      }
    }

    /* --- ç‰¹æ•ˆ 8ï¼šæ˜Ÿé›²éœ¸ä¸» (éŠ€æ²³ç¹æ˜Ÿç‰ˆ) --- */
    .fx-nebula {
      position: relative !important;
      background: transparent !important;
      border: 2px solid transparent !important;
      color: #fff !important;
      overflow: hidden !important;
      box-shadow: 0 0 20px #7b2cbf, 0 0 40px #e0aaff !important;
      text-shadow: 0 0 5px #fff, 0 0 10px #ff00de !important;
      z-index: 1;
    }

    /* é‚Šæ¡†å±¤ */
    .fx-nebula::before {
      content: "";
      position: absolute;
      inset: -3px;
      background: conic-gradient(from 0deg, #ff00de, #7b2cbf, #4cc9f0, #ff00de);
      z-index: -2;
      animation: spin-super-fast 3s linear infinite;
      border-radius: 12px;
    }

    /* èƒŒæ™¯å±¤ï¼šæ¥µè‡´å¯†åº¦çš„æ˜Ÿç©º */
    .fx-nebula::after {
      content: "";
      position: absolute;
      inset: 3px;
      background:
        /* Bright Stars (Big) */
        radial-gradient(2px 2px at 15% 15%, #fff, transparent),
        radial-gradient(2px 2px at 50% 20%, #fff, transparent),
        radial-gradient(2px 2px at 85% 15%, #fff, transparent),
        radial-gradient(2px 2px at 10% 80%, #fff, transparent),
        radial-gradient(2px 2px at 90% 85%, #fff, transparent),

        /* Medium Stars */
        radial-gradient(1.5px 1.5px at 30% 40%, rgba(255, 255, 255, 0.8), transparent),
        radial-gradient(1.5px 1.5px at 70% 60%, rgba(255, 255, 255, 0.8), transparent),
        radial-gradient(1.5px 1.5px at 20% 60%, rgba(255, 255, 255, 0.8), transparent),
        radial-gradient(1.5px 1.5px at 80% 30%, rgba(255, 255, 255, 0.8), transparent),

        /* Tiny Stars Cluster */
        radial-gradient(1px 1px at 5% 5%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 25% 25%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 45% 45%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 65% 65%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 85% 85%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 15% 75%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 35% 95%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 55% 15%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 75% 35%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 95% 55%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 2% 40%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 98% 60%, rgba(255, 255, 255, 0.5), transparent),

        /* Deep Background */
        linear-gradient(135deg, #12002f 0%, #30005a 100%);
      background-size: 200% 200%;
      z-index: -1;
      border-radius: 10px;
      animation: nebula-bg-shift 6s ease infinite alternate;
    }

    @keyframes nebula-bg-shift {
      0% {
        background-position: 0% 50%;
      }

      100% {
        background-position: 100% 50%;
      }
    }

    /* --- ç‰¹æ•ˆ 9ï¼šæ™‚å…‰é ˜ä¸» (é½’è¼ªå›æ­¸ç‰ˆ) --- */
    .fx-timelord {
      position: relative !important;
      background-color: #111 !important;
      /* å°‡ç¶²æ ¼èƒŒæ™¯ç§»åˆ°ä¸»å…ƒç´ ï¼Œè®“å‡º ::before çµ¦é½’è¼ª */
      background-image:
        linear-gradient(#444 1px, transparent 1px),
        linear-gradient(90deg, #444 1px, transparent 1px);
      background-size: 30px 30px;
      color: #ffd700 !important;
      border: 2px solid #ffd700 !important;
      overflow: hidden !important;
      box-shadow: inset 0 0 20px #000, 0 0 15px #ffd700 !important;
      z-index: 1;
      animation: bg-grid-scroll 4s linear infinite !important;
    }

    /* 1. å·¨å¤§é‡‘å±¬é½’è¼ª (å›æ­¸) */
    .fx-timelord::before {
      content: "âš™ï¸";
      position: absolute;
      right: -25px;
      bottom: -25px;
      font-size: 90px;
      opacity: 0.15;
      z-index: 0;
      animation: rotate-slow 10s linear infinite;
      filter: grayscale(1) brightness(1.5);
    }

    /* 2. é»ƒé‡‘æŒ‡é‡æƒé (Overlay æ¨¡å¼) */
    .fx-timelord::after {
      content: "";
      position: absolute;
      top: -100%;
      left: -50%;
      width: 200%;
      height: 300%;
      /* ä½¿ç”¨ hard-light æ··åˆæ¨¡å¼ */
      background: conic-gradient(from 0deg, transparent 0deg, rgba(255, 230, 0, 0.4) 15deg, rgba(255, 255, 255, 0.9) 20deg, transparent 25deg, transparent 40deg);
      animation: radar-sweep 3s linear infinite;
      z-index: 2;
      /* æ”¾åœ¨æœ€ä¸Šå±¤ */
      pointer-events: none;
      /* è®“é»æ“Šç©¿é€ */
      mix-blend-mode: hard-light;
      /* è®“å…‰æ•ˆç–ŠåŠ åœ¨æ–‡å­—ä¸Š */
    }

    @keyframes bg-grid-scroll {
      0% {
        background-position: 0 0;
      }

      100% {
        background-position: 0 30px;
      }
    }

    @keyframes grid-move {
      0% {}

      100% {
        transform: translateY(30px);
      }
    }

    @keyframes radar-sweep {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }


    /* --- ç‰¹æ•ˆ 10ï¼šçœ¾ç¥ä¹‹ç‹ (MAXIMALISM VERSION) --- */
    .fx-god-king {
      position: relative !important;
      /* Radiant sunburst gradient */
      background: radial-gradient(circle at center, #ffecb3 0%, #ffd700 40%, #a07e00 100%) !important;
      border: 2px solid #fff !important;
      color: #5c0a0a !important;
      /* Dark text for contrast */
      font-weight: 900 !important;
      overflow: hidden !important;
      /* Blinding outer glow */
      box-shadow: 0 0 30px #ffd700, 0 0 60px #fff, 0 0 80px #ffea00 !important;
      text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
      /* White outline for text */
      animation: god-pulse 2s ease-in-out infinite !important;
      z-index: 1;
    }

    /* Rotating Rays - Stronger contrast */
    .fx-god-king::before {
      content: "";
      position: absolute;
      top: -100%;
      left: -100%;
      width: 300%;
      height: 300%;
      background: repeating-conic-gradient(from 0deg,
          rgba(255, 255, 255, 0.4) 0deg 5deg,
          transparent 5deg 15deg);
      animation: spin-slow 10s linear infinite;
      z-index: 0;
    }

    /* Falling Gold Dust / Sparkles */
    .fx-god-king::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(circle, #fff 1px, transparent 1px),
        radial-gradient(circle, #fff 2px, transparent 2px);
      background-size: 15px 15px, 30px 30px;
      animation: god-particles 1s linear infinite;
      z-index: 0;
      opacity: 0.6;
    }

    @keyframes nebula-float {
      0% {
        transform: translateY(0px) scale(1);
      }

      100% {
        transform: translateY(-3px) scale(1.02);
      }
    }

    @keyframes spin-super-fast {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes time-warp {
      0% {
        transform: perspective(300px) rotateX(20deg) translateY(0);
      }

      100% {
        transform: perspective(300px) rotateX(20deg) translateY(-20px);
      }
    }

    @keyframes god-pulse {

      0%,
      100% {
        transform: scale(1);
        box-shadow: 0 0 30px #ffd700;
      }

      50% {
        transform: scale(1.03);
        box-shadow: 0 0 50px #ffd700, 0 0 80px #fff;
      }
    }

    @keyframes god-particles {
      from {
        background-position: 0 0, 0 0;
      }

      to {
        background-position: 0 15px, 0 30px;
      }
    }


    /* --- ç‰¹æ•ˆ 11ï¼šä¸ƒå½©éœ“è™¹æµå…‰ç‰¹æ•ˆ (fx-rainbow) --- */
    .fx-rainbow {
      background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff) !important;
      background-size: 400% 400% !important;
      animation: rainbow-move 3s ease infinite !important;
      color: #fff !important;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5) !important;
      border: none !important;
    }

    @keyframes rainbow-move {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    /* --- ç‰¹æ•ˆ 12ï¼šæš—å½±é›·é›»ç‰¹æ•ˆ (fx-lightning) --- */
    .fx-lightning {
      background: #000 !important;
      color: #fff !important;
      box-shadow: 0 0 10px #00d2ff, 0 0 20px #3a7bd5 inset !important;
      animation: lightning-flash 2s infinite !important;
    }

    @keyframes lightning-flash {

      0%,
      90%,
      100% {
        opacity: 1;
      }

      92% {
        filter: brightness(3);
        transform: scale(1.02);
      }

      94% {
        filter: brightness(1);
      }

      96% {
        filter: brightness(2.5);
      }
    }

    /* --- æ–°ç‰¹æ•ˆå‹•ç•«å®šç¾© --- */
    @keyframes ice-shimmer {
      from {
        filter: saturate(1) brightness(1);
        box-shadow: 0 0 5px #00f2fe;
      }

      to {
        filter: saturate(1.5) brightness(1.2);
        box-shadow: 0 0 20px #00f2fe;
      }
    }

    @keyframes lightning-strike {

      0%,
      95%,
      98% {
        opacity: 0;
      }

      96%,
      99% {
        opacity: 0.4;
      }

      /* æ¨¡æ“¬é›·é›¨é–ƒé›»ç¬é–“é–ƒçˆ */
    }

    @keyframes void-pulse {

      0%,
      100% {
        transform: scale(1);
        filter: blur(0px);
      }

      50% {
        transform: scale(0.98);
        filter: blur(0.5px);
      }
    }

    @keyframes rotate-slow {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }


    .rank-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .rank-num {
      min-width: 25px;
      text-align: center;
      font-weight: bold;
    }

    .rank-bal {
      color: #f1c40f;
      font-weight: bold;
    }

    .header {
      height: 50px;
      flex-shrink: 0;
      background: linear-gradient(to bottom, #5c0a0a, #2a0202);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      border-bottom: 2px solid var(--gold);
      z-index: 100;
    }

    .logo {
      font-size: 18px;
      font-weight: 900;
      color: var(--gold);
    }

    .balance-display {
      background: rgba(0, 0, 0, 0.6);
      padding: 4px 12px;
      border-radius: 20px;
      border: 1px solid var(--gold);
      font-size: 15px;
      color: var(--gold);
      font-weight: bold;
      cursor: pointer;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      overflow: hidden;
    }

    .welcome-msg {
      font-size: 14px;
      color: #ccc;
      text-align: center;
      margin-bottom: 8px;
    }

    .game-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      align-content: start;
      overflow-y: auto;
      padding-bottom: 10px;
    }

    .game-card {
      background: var(--card-bg);
      border: 1px solid #444;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      text-decoration: none;
      color: inherit;
      min-height: 85px;
      transition: transform 0.1s;
    }

    .game-img {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }

    .game-info {
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 0 0 12px 12px;
    }

    .game-title {
      font-size: 12px;
      color: var(--gold);
      font-weight: bold;
    }

    .deposit-area {
      width: 100%;
      display: flex;
      gap: 10px;
      flex-shrink: 0;
      padding: 10px 0;
    }

    .btn-deposit {
      flex: 2;
      padding: 12px;
      border-radius: 12px;
      border: 2px solid var(--gold);
      background: linear-gradient(#ff4757, #b91c1c);
      color: #fff;
      font-size: 18px;
      font-weight: 900;
    }

    .btn-rank {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: 2px solid var(--gold);
      background: linear-gradient(#f59e0b, #92400e);
      color: #fff;
      font-size: 15px;
      font-weight: 900;
    }

    .footer {
      text-align: center;
      padding: 5px 0;
      font-size: 10px;
      color: #444;
    }

    /* --- æ’è¡Œæ¦œå´é‚Šæ¬„ä¿®æ­£ --- */
    #rankOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      z-index: 2999;
    }

    #rankSidebar {
      position: fixed;
      top: 0;
      right: -100%;
      /* åˆå§‹éš±è—åœ¨å³å´ */
      max-width: 95%;
      height: 100%;
      background: #1a0202;
      border-left: 2px solid var(--gold);
      z-index: 3000;
      transition: 0.3s ease;
      display: flex;
      flex-direction: column;
      padding: 20px;
      padding-top: calc(env(safe-area-inset-top) + 20px);
    }

    #rankSidebar.active {
      right: 0;
    }

    /* å•Ÿå‹•æ™‚æ‹‰å›è¢å¹• */

    .rank-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--gold);
      padding-bottom: 10px;
    }

    .rank-list {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden !important;
      margin-top: 10px;
    }

    .rank-item {
      display: flex;

      justify-content: space-between;
      padding: 12px 5px;
      border-bottom: 1px solid rgba(255, 216, 107, 0.1);
      font-size: 14px;
    }

    .rank-num {
      color: var(--gold);
      font-weight: bold;
      width: 25px;
    }

    .rank-name {
      flex: 1;
      margin-left: 5px;
    }

    .rank-bal {
      color: #fff;
    }

    .close-rank {
      font-size: 30px;
      color: var(--gold);
      cursor: pointer;
    }



    /* æ©«å‘æ¨¡å¼èª¿æ•´ */
    @media (orientation: landscape) {
      .game-grid {
        grid-template-columns: repeat(5, 1fr);
      }

      .game-card {
        min-height: 65px;
      }

      .game-img {
        font-size: 22px;
      }
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-content {
      background: #1a1a1a;
      border: 2px solid var(--gold);
      padding: 20px;
      border-radius: 20px;
      width: 85%;
      max-width: 320px;
      text-align: center;
    }

    .modal-btn {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
    }

    /* è‡³å°Šå‚³å¥‡ï¼šåœ¨ä¸æ”¹å‹•ä½ åŸæœ¬è¨­å®šçš„å‰æä¸‹ï¼ŒåŠ å…¥æµå‹•é‚Šæ¡† */
    .fx-ultimate-legend {
      position: relative;
      /* --- 1. ä½ åŸæœ¬çš„æ¨£å¼å®Œå…¨ä¿ç•™ --- */
      background: linear-gradient(90deg, #000 0%, #FFD700 20%, #FFFFFF 40%, #FF4500 60%, #9400D3 80%, #000 100%) !important;
      background-size: 300% 100% !important;
      z-index: 1;
      overflow: visible !important;
      width: 100% !important;
      box-sizing: border-box !important;

      /* --- 2. åœ“è§’é—œéµè¨­å®š --- */
      border-radius: 50px !important;
      /* ç¢ºä¿åœ“å¼§å­˜åœ¨ */
      /* é ç•™é‚Šæ¡†ç©ºé–“ */
      background-clip: padding-box !important;
      /* é˜²æ­¢èƒŒæ™¯æº¢å‡ºåˆ°é‚Šæ¡†å€åŸŸ */

      /* --- 3. é‚Šæ¡†ç‰¹æ•ˆï¼šåˆ©ç”¨å¤šé‡é™°å½±æ¨¡æ“¬æµå…‰é‚Šæ¡† --- */
      /* é€™è¡Œæœƒåœ¨åœ“å¼§é‚Šç·£åŠ ä¸Šä¸€é“é‡‘å±¬å…‰æ„Ÿï¼Œä¸”ä¸ç ´å£åœ“è§’ */
      box-shadow: 0 0 0 1.5px #FFD700, 0 0 10px rgba(255, 215, 0, 0.5);

      animation: ult-bg-flow 4s linear infinite, ult-vibrate 0.15s infinite;
    }

    /* --- æ–°å¢é‚Šæ¡†å°ˆç”¨å‹•ç•« --- */
    @keyframes border-flow {
      0% {
        border-image-source: linear-gradient(0deg, #FFD700, #FF4500, #9400D3, #FFD700);
      }

      100% {
        border-image-source: linear-gradient(360deg, #FFD700, #FF4500, #9400D3, #FFD700);
      }
    }

    /* æ”¹é€ å¾Œçš„é™°å½±å±¤ï¼šå¤šè‰²å‘¼å¸ç™¼å…‰ */
    .fx-ultimate-legend::after {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 52px;
      z-index: -1;
      filter: blur(12px);
      /* ç¨å¾®åŠ æ·±æ¨¡ç³Šï¼Œæ›´æœ‰èƒ½é‡å ´çš„æ„Ÿè¦º */
      opacity: 0.7;
      /* åŸ·è¡Œå¤šè‰²é™°å½±è®Šæ›å‹•ç•« */
      animation: ult-shadow-glow 3s ease-in-out infinite alternate;
    }

    /* æ–‡å­—å±¤ç¶­æŒä½ åŸæœ¬çš„æµå…‰è³ªæ„Ÿ */
    .fx-ultimate-legend span {
      position: relative;
      z-index: 20 !important;
      background: linear-gradient(to right, #fff 20%, #ffd700 40%, #ff4500 60%, #fff 80%);
      background-size: 200% auto;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: ult-text-flow 2s linear infinite;
      font-weight: 900;
      filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
    }

    /* --- æ–°å¢/ä¿®æ”¹å‹•ç•«å®šç¾© --- */
    .fx-ultimate-legend::before {
      content: '';
      position: absolute;
      /* è®“é€™å€‹å±¤æ¯”ä¸»é«”å¤§ä¸€é»é»ï¼Œç•¶ä½œé‚Šæ¡† */
      inset: 0px;
      border-radius: 50px;
      padding: 1.5px;
      /* é‚Šæ¡†å¯¬åº¦ */

      /* é‚Šæ¡†çš„æµå‹•æ¼¸å±¤é¡è‰² */
      background: linear-gradient(90deg, #FFD700, #FFFFFF, #FF4500, #9400D3, #FFD700);
      background-size: 200% auto;
      mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
      /* é®ç½©é»‘ç§‘æŠ€ï¼šåªé¡¯ç¤ºé‚Šæ¡†ï¼Œä¸­é–“æŒ–ç©º */
      -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;

      /* é‚Šæ¡†æµå‹•å‹•ç•« */
      animation: ult-text-flow 2s linear infinite;
      z-index: 2;
    }

    /* èƒŒæ™¯æµå‹•ï¼šè®“é»‘æ¡†è£¡çš„é¡è‰²å‹•èµ·ä¾† */
    @keyframes ult-bg-flow {
      0% {
        background-position: 0% 50%;
      }

      100% {
        background-position: 300% 50%;
      }
    }

    /* å¤šè‰²é™°å½±è®Šæ›ï¼šè£œå„ŸåŸæœ¬ JS ç²’å­çš„é¡è‰²å‹•æ…‹ */
    @keyframes ult-shadow-glow {
      0% {
        background: #0f12dd;
        box-shadow: 0 0 15px #0f12dd, 0 0 30px rgba(255, 215, 0, 0.4);
      }

      50% {
        background: #9400D3;
        box-shadow: 0 0 20px #9400D3, 0 0 40px rgba(148, 0, 211, 0.4);
      }

      100% {
        background: #FF4500;
        box-shadow: 0 0 15px #FF4500, 0 0 30px rgba(255, 69, 0, 0.4);
      }
    }

    /* åŸæœ¬çš„å‹•ç•«ä¿ç•™ */
    @keyframes ult-text-flow {
      0% {
        background-position: 0% center;
      }

      100% {
        background-position: 200% center;
      }
    }

    @keyframes ult-vibrate {
      0% {
        transform: translate(0, 0);
      }

      50% {
        transform: translate(0.5px, -0.5px);
      }

      100% {
        transform: translate(0, 0);
      }
    }

    /* çµ•ä¸–ç‰¹æ•ˆï¼šéŒ¦é¯‰èºé· (çµ‚æ¥µå‹•æ…‹ç‰ˆ) */
    .fx-cosmic-koi {
      position: relative;
      padding: 12px 20px;
      border-radius: 15px;
      color: white !important;
      font-weight: bold;
      text-align: center;
      text-shadow: 0 0 10px rgba(255, 158, 0, 0.8);
      overflow: hidden;
      /* ç¢ºä¿æµå…‰èˆ‡ç²’å­ä¸æº¢å‡º */
      z-index: 1;
      border: none;
      background: #10002b;
      /* æ·±è‰²åº•ï¼Œé˜²æ­¢èƒŒæ™¯ç¸®æ”¾æ™‚éœ²åº• */
    }

    /* 1. æµå…‰é‚Šæ¡†æ—‹è½‰å±¤ (::before) */
    .fx-cosmic-koi::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(transparent,
          #ff9e00 10%,
          #ff0054 20%,
          transparent 30%,
          transparent 70%,
          #9d4edd 80%,
          #ff9e00 90%);
      animation: koiRotate 4s linear infinite;
      z-index: -2;
    }

    /* 2. èƒŒæ™¯èˆ‡ç²’å­çµ„åˆå±¤ (::after) */
    /* é€™ä¸€å±¤è² è²¬èƒŒæ™¯æ¼¸è®Šã€ç²’å­ã€ä»¥åŠç¸®æ”¾æ•ˆæœ */
    .fx-cosmic-koi::after {
      content: '';
      position: absolute;
      inset: 3px;
      /* é€™è£¡æ±ºå®šé‚Šæ¡†çš„ç²—ç´° (3px) */
      background:
        /* æ‡¸æµ®ç²’å­åœ–æ¡ˆ */
        radial-gradient(circle, rgba(255, 255, 255, 0.3) 1px, transparent 1px),
        /* åº•å±¤æ¼¸è®ŠèƒŒæ™¯ */
        linear-gradient(135deg, #240046 0%, #3c096c 50%, #5a189a 100%);
      background-size: 20px 20px, 400% 400%;
      /* ç²’å­å¯†åº¦èˆ‡èƒŒæ™¯å°ºå¯¸ */
      border-radius: 12px;
      z-index: -1;
      /* é€™è£¡åŒæ™‚åŸ·è¡Œï¼šç²’å­é£„æµ®å‹•ç•«ã€èƒŒæ™¯æµå‹•ã€æ•´é«”ç¸®æ”¾ */
      animation:
        koiParticleMove 20s linear infinite,
        koiBgFlow 8s ease infinite,
        koiScaleBreath 3s ease-in-out infinite;
    }

    @keyframes koiRotate {
      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes koiParticleMove {
      0% {
        background-position: 0px 0px, 0% 50%;
      }

      100% {
        background-position: 100px 100px, 100% 50%;
      }
    }

    /* å‹•ç•«å®šç¾© */
    @keyframes rotateBorder {
      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes koiScaleBreath {

      0%,
      100% {
        transform: scale(1);
        opacity: 0.9;
      }

      50% {
        transform: scale(1.05);
        opacity: 1;
      }
    }

    @keyframes koiFlow {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    @keyframes koiBgFlow {

      0%,
      100% {
        background-position: 20px 20px, 0% 50%;
      }

      50% {
        background-position: 20px 20px, 100% 50%;
      }
    }

    @keyframes koiGlow {

      0%,
      100% {
        box-shadow: inset 0 0 0 2px rgba(16, 0, 43, 0.9), 0 0 10px rgba(255, 158, 0, 0.4);
      }

      50% {
        box-shadow: inset 0 0 0 2px rgba(16, 0, 43, 0.9), 0 0 25px rgba(255, 158, 0, 0.7);
      }
    }

    .player-title.t-koi {
      color: #fff;
      text-shadow:
        0 0 5px #fff,
        0 0 10px #ff00de,
        0 0 15px #ff00de;
      animation: koi-text-glow 1.5s ease-in-out infinite alternate;
    }

    @keyframes koi-text-glow {
      from {
        filter: drop-shadow(0 0 2px #fff);
      }

      to {
        filter: drop-shadow(0 0 8px #ff00de);
      }
    }

    /* å‹•ç•«å®šç¾© */
    @keyframes cosmic-border {
      0% {
        background-position: 0% 0%, 0% 50%;
      }

      100% {
        background-position: 0% 0%, 300% 50%;
      }
    }

    @keyframes koi-scales {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    @keyframes koi-sweep {
      0% {
        left: -100%;
      }

      100% {
        left: 200%;
      }
    }

    /* éŒ¦é¯‰å°ˆå±¬å½©è‰²æ–‡å­— */
    .t-koi-color {
      background: linear-gradient(to right, #ff9e00, #ff0054, #9d4edd, #ff9e00);
      background-size: 200% auto;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: koiTextMove 3s linear infinite;
      font-weight: bold;
      filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.5));
    }

    @keyframes koiTextMove {
      to {
        background-position: 200% center;
      }
    }

    .lotto-box {
      background: linear-gradient(135deg, #1a1a1a, #2c3e50);
      border: 3px solid #ffd700;
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      width: 85%;
      max-width: 350px;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
    }

    .lotto-item {
      margin: 15px 0;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      color: #fff;
      animation: item-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    @keyframes item-pop {
      0% {
        transform: scale(0);
        opacity: 0;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .close-btn {
      margin-top: 20px;
      padding: 10px 30px;
      background: var(--gold);
      border: none;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div class="header">
    <div class="logo-area" style="text-align: center; margin: 15px 0;">
  <button onclick="openWishModal()" style="background: linear-gradient(135deg, #6a11cb, #2575fc); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 10px 20px; border-radius: 25px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
    <span>ğŸŒŒ</span>è¨±é¡˜æ± 
  </button>
</div>

<div id="wishModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200000; align-items: center; justify-content: center; font-family: sans-serif;">
  <div style="width: 85%; max-width: 350px; background: #1e1e1e; border: 2px solid #2575fc; border-radius: 20px; padding: 25px; box-sizing: border-box;">
    <h3 style="color: #2575fc; margin-top: 0; text-align: center;">ğŸŒ  è¨±ä¸‹ä½ çš„é¡˜æœ›</h3>
    <p style="font-size: 12px; color: #aaa; text-align: center;">æŠ•éŒ¢è¨±é¡˜</p>
    
    <select id="wishType" style="width: 100%; padding: 10px; border-radius: 10px; background: #333; color: white; border: 1px solid #444; margin-bottom: 15px;">
      <option value="new_game">æƒ³è¦æ–°éŠæˆ²</option>
      <option value="bug_report">BUG å›é¥‹</option>
      <option value="suggestion">å»ºè­°</option>
      <option value="other">å…¶ä»–</option>
    </select>

    <textarea id="wishContent" placeholder="è«‹è¼¸å…¥å…§å®¹..." style="width: 100%; height: 120px; padding: 12px; border-radius: 10px; background: #333; color: white; border: 1px solid #444; box-sizing: border-box; font-size: 14px; resize: none;"></textarea>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button onclick="closeWishModal()" style="flex: 1; padding: 12px; border-radius: 10px; border: none; background: #444; color: white;">å–æ¶ˆ</button>
      <button id="submitWishBtn" onclick="submitWish()" style="flex: 1; padding: 12px; border-radius: 10px; border: none; background: #2575fc; color: white; font-weight: bold;">å‚³é€é¡˜æœ›</button>
    </div>
  </div>
</div>
    <div style="color:var(--gold); font-size:13px; cursor:pointer; text-decoration:underline;" onclick="openShop()">ğŸªå•†åŸ
    </div>
    <div style="color:#ff4757; font-size:13px; cursor:pointer; text-decoration:underline; font-weight:bold;"
      onclick="playLotto()">ğŸ“…æ¨‚é€</div>
    <div class="balance-display" onclick="toggleRank()">ğŸ’ <span id="mainBalance">0</span></div>
  </div>
  <div>
    <marquee style="flex:1; color:var(--gold);">ç·šä¸Šæ¸¬è©¦ç‰ˆï¼Œé»è‡ªå·±åå­å¯ä»¥æ”¹å</marquee>
    <button onclick="loginWithID()" style="
        border: 1px solid #00d4ff; 
        color: #00d4ff; 
        border-radius: 20px; 
        font-size: 12px; 
        cursor: pointer;
        box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
    ">
      ğŸ”„ åˆ‡æ›å¸³è™Ÿ
    </button>
  </div>

  <div class="container">

    <div class="welcome-msg" id="welcomeUser" onclick="changePlayerName()"
      style="cursor: pointer; display: inline-block; min-height: 20px;">
      è¼‰å…¥ä¸­...
    </div>

    <div class="welcome-msg">
      <span id="welcomeUserContainer">é¸æ“‡éŠæˆ²</span>
    </div>

    <div class="game-grid">
      <a href="sicbo.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #0a5c32, #084325);">ğŸ²</div>
        <div class="game-info">
          <div class="game-title">éª°å¯¶</div>
        </div>
      </a>

      <a href="slot.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #4a0404, #2a0202);">ğŸ°</div>
        <div class="game-info">
          <div class="game-title">777æ‹‰éœ¸æ©Ÿ</div>
        </div>
      </a>
      <a href="horse.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #1e3a8a, #1e1b4b);">ğŸ</div>
        <div class="game-info">
          <div class="game-title">è³½é¦¬å ´</div>
        </div>
      </a>
      <a href="gemslot.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #5b8a1e, #d1f51e);">ğŸ’</div>
        <div class="game-info">
          <div class="game-title">å¯¶çŸ³ç¤¦å‘</div>
        </div>
      </a>
      <a href="link.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #0f3fc4, #12e7f6);">ğŸ²</div>
        <div class="game-info">
          <div class="game-title">æ¶ˆæ¶ˆæ¨‚</div>
        </div>
      </a>
      <a href="mahj.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #e833a2, #d26019);">ğŸ€„</div>
        <div class="game-info">
          <div class="game-title">éº»å°‡æ¶ˆæ¶ˆæ¨‚</div>
        </div>
      </a>
      <a href="heart.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #fcb1df, #f5ac7f);">â¤ï¸</div>
        <div class="game-info">
          <div class="game-title">æ„›å¿ƒ</div>
        </div>
      </a>
      <a href="foodlink.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #f1c1c1, #56f19e);">ğŸ°</div>
        <div class="game-info">
          <div class="game-title">é€£é€£çœ‹</div>
        </div>
      </a>
      <a href="bomb.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #ff0505, #00c3ff);">ğŸ—ºï¸</div>
        <div class="game-info">
          <div class="game-title">å°‹å¯¶å†’éšª</div>
        </div>
      </a>
      <a href="gua.html" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #312222, #bad7c7);">ğŸ§§</div>
        <div class="game-info">
          <div class="game-title">åˆ®åˆ®æ¨‚</div>
        </div>
      </a>
      <a href="#" class="game-card">
        <div class="game-img" style="background: linear-gradient(45deg, #ff00cc, #0015ff);">âš”ï¸</div>
        <div class="game-info">
          <div class="game-title">é–‹ç™¼ä¸­</div>
        </div>
      </a>
    </div>

    <div class="deposit-area">
      <button class="btn-rank" onclick="openPetTemple()">ğŸ¾ å¯µç‰©</button>
      <button class="btn-deposit" onclick="openModal()">ğŸ’¸ è¬€å‰é˜¿</button>
      <button class="btn-rank" onclick="toggleRank()">ğŸ† æ’è¡Œ</button>
    </div>
  </div>

  <div class="footer">
    &copy; é˜¿è¨˜å¨›æ¨‚åŸ
  </div>

  <div id="rankOverlay" onclick="toggleRank()"></div>
  <div id="rankSidebar">
    <div class="rank-header">
      <h2 style="color:var(--gold); margin:0;">ğŸ’æ’è¡Œæ¦œ</h2>
      <span class="close-rank" onclick="toggleRank()">&times;</span>
    </div>
    <div class="rank-list" id="rankList">
      <p style="text-align:center; color:#888;">è¼‰å…¥ä¸­...</p>
    </div>
  </div>

  <div id="depositModal" class="modal">
    <div class="modal-content">
      <h2 style="color:var(--gold); margin-bottom:15px; font-size: 22px;">åˆ·é˜¿è¨˜çš„å¡ï¼Œé˜¿è¨˜çš„éŒ¢æœ‰é™ï¼Œä¸€å¤©ä¸€æ¬¡(æš«æ™‚ç„¡é™)</h2>
      <button class="modal-btn" style="background:#f59e0b;" onclick="handleDeposit(1000000)">å„²å€¼ 1,000,000</button>
      <button class="modal-btn" style="background:#444; color:#ccc;" onclick="closeModal()">ç®—äº†</button>
    </div>
  </div>
  <div id="shopModal" class="modal">
    <div class="modal-content" style="max-width: 380px; padding: 15px;">
      <h2 style="color:var(--gold); margin-bottom:10px;">éŠæˆ²å•†åŸ</h2>

      <div style="display:flex; gap:5px; margin-bottom:15px;">
        <button class="modal-btn" id="tabTitle" style="margin:0; background:var(--red);"
          onclick="switchShop('title')">ç¨±è™Ÿ</button>
        <button class="modal-btn" id="tabEffect" style="margin:0; background:#444;"
          onclick="switchShop('effect')">ç‰¹æ•ˆ</button>
      </div>

      <div id="shopList" style="max-height: 300px; overflow-y: auto;">
      </div>

      <button class="modal-btn" style="background:#222; margin-top:10px; border:1px solid #444;"
        onclick="closeShop()">é›¢é–‹å•†åŸ</button>
    </div>
  </div>

  <div id="nameModal" class="modal">
    <div class="modal-content">
      <h2 style="color:var(--gold);">è«‹è¼¸å…¥éŠæˆ²æš±ç¨±</h2>
      <p style="color:#ccc; font-size:14px;">ç”¨æ–¼æ’è¡Œæ¦œé¡¯ç¤º</p>
      <input type="text" id="nicknameInput" placeholder="æœ€å¤š8å€‹å­—" maxlength="8">
      <button class="modal-btn" style="background:var(--red);" onclick="saveNewPlayer()">é€²å…¥éŠæˆ²</button>
    </div>
  </div>
  <div id="lottoModal" class="modal">
    <div class="lotto-box">
      <h2>ğŸ“… æ¯æ—¥é–‹ççµæœ</h2>
      <div id="lottoResultArea">
      </div>
      <button onclick="closeLottoModal()" class="close-btn">ç¢ºèªæ”¶ä¸‹</button>
    </div>
  </div>
  <div id="toast-msg"
    style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(0,0,0,0.8); color:white; padding:15px 30px; border-radius:30px; z-index:9999; font-size:16px; white-space:nowrap; border:1px solid #ffd700; box-shadow: 0 0 15px rgba(0,0,0,0.5);">
    âœ… å„²å€¼æˆåŠŸ
  </div>

  <audio id="sndCash" src="https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3" preload="auto"></audio>

  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore-compat.js"></script>

  <script>
    const _k = ["AIzaSyDSRfVA", "uWCWCUd1NJop", "J6wHvsqsAM4UzJA"];

    const firebaseConfig = {
      apiKey: _k.join(''),
      authDomain: "game-80d68.firebaseapp.com",
      projectId: "game-80d68",
      storageBucket: "game-80d68.firebasestorage.app",
      messagingSenderId: "636332967920",
      appId: "1:636332967920:web:29e5600daf4db0ab613f35",
      measurementId: "G-MJZ4PGEHSQ"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    function updateMainBalance() {
      const balance = localStorage.getItem('sicbo_balance') || '5000';
      document.getElementById('mainBalance').textContent = Math.floor(parseFloat(balance)).toLocaleString();
    }

    function openModal() { document.getElementById('depositModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('depositModal').style.display = 'none'; }
// é–‹å•Ÿè¨±é¡˜æ± 
function openWishModal() {
    document.getElementById('wishModal').style.display = 'flex';
}

// é—œé–‰è¨±é¡˜æ± 
function closeWishModal() {
    document.getElementById('wishModal').style.display = 'none';
    document.getElementById('wishContent').value = ''; // æ¸…ç©ºå…§å®¹
}

// æäº¤é¡˜æœ›åˆ° Firebase
async function submitWish() {
    const type = document.getElementById('wishType').value;
    const content = document.getElementById('wishContent').value.trim();
    const playerId = localStorage.getItem('player_id') || 'guest';
    const playerName = localStorage.getItem('player_name') || 'ç„¡åæ°';
    const btn = document.getElementById('submitWishBtn');

    if (!content) return alert("å…§å®¹ä¸èƒ½æ˜¯ç©ºçš„å–”ï¼");

    btn.disabled = true;
    btn.textContent = "å‚³é€ä¸­...";

    try {
        await db.collection("wishes").add({
            type: type,
            content: content,
            uid: playerId,
            nickname: playerName,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            status: "pending" // é è¨­ç‚ºå¾…è™•ç†
        });

        alert("ğŸš€ é¡˜æœ›å·²å‚³é”ï¼");
        closeWishModal();
    } catch (e) {
        console.error("è¨±é¡˜å¤±æ•—:", e);
        alert("ç¨å¾Œå†è©¦ã€‚");
    } finally {
        btn.disabled = false;
        btn.textContent = "å‚³é€é¡˜æœ›";
    }
}
    /**
 * ä½¿ç”¨ Firebase ID ç™»å…¥å¼•ç¹¼
 */
    // ä¿®æ”¹å¾Œçš„ç™»å…¥åŠŸèƒ½ï¼Œç¢ºä¿ç¨±è™Ÿç‰¹æ•ˆåŒæ­¥
    /**
     * ä½¿ç”¨ Firebase ID ç™»å…¥å¼•ç¹¼
     * æœƒåŒæ­¥ï¼šIDã€æš±ç¨±ã€é¤˜é¡ã€æ‰€æœ‰è³‡ç”¢åˆ°æœŸæ—¥ã€ç•¶å‰è£å‚™ç‹€æ…‹
     */
    async function loginWithID() {
      // 1. å–å¾—ç›®æ¨™ ID
      const targetID = prompt("è«‹è¼¸å…¥å¼•ç¹¼ç¢¼ï¼š");
      if (!targetID || targetID.trim() === "") return;

      const newID = targetID.trim();
      const currentID = localStorage.getItem('player_id');

      // å¦‚æœè¼¸å…¥çš„å°±æ˜¯ç›®å‰çš„ IDï¼Œå°±ä¸å¿…åŸ·è¡Œ
      if (newID === currentID) {
        alert("æ‚¨ç›®å‰å°±æ˜¯æ­¤å¸³è™Ÿã€‚");
        return;
      }

      try {
        // 2. æª¢æŸ¥ç›®æ¨™ ID åœ¨ Firebase æ˜¯å¦å­˜åœ¨
        const doc = await db.collection("users").doc(newID).get();
        if (!doc.exists) {
          alert("âŒ æ‰¾ä¸åˆ°è©² ID çš„ç´€éŒ„ï¼Œè«‹æª¢æŸ¥è¼¸å…¥æ˜¯å¦æ­£ç¢ºã€‚");
          return;
        }

        // 3. äºŒæ¬¡ç¢ºèªï¼ˆé‡å°å·²æœ‰ç´€éŒ„çš„ç©å®¶ï¼‰
        const confirmMsg = currentID
          ? "âš ï¸ æ³¨æ„ï¼šæ‚¨ç›®å‰å·²æœ‰éŠæˆ²ç´€éŒ„ã€‚\nå¼•ç¹¼å°‡æœƒç™»å‡ºç›®å‰å¸³è™Ÿä¸¦è¼‰å…¥æ–°å¸³è™Ÿè³‡æ–™ã€‚\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ"
          : "ç¢ºå®šè¦å¼•ç¹¼æ­¤å¸³è™Ÿä¸¦è¼‰å…¥æ‰€æœ‰é›²ç«¯ç´€éŒ„å—ï¼Ÿ";

        if (confirm(confirmMsg)) {
          // 4. æ¸…é™¤æœ¬åœ°èˆŠè³‡æ–™ï¼Œé¿å…èˆŠå¸³è™Ÿçš„é¤˜é¡æˆ–è³‡ç”¢æ®˜ç•™
          localStorage.clear();

          // 5. å¯«å…¥æ–° ID
          localStorage.setItem('player_id', newID);

          alert("âœ… å¼•ç¹¼æˆåŠŸï¼æ­£åœ¨é‡æ–°è¼‰å…¥éŠæˆ²æ•¸æ“š...");

          // 6. å¼·åˆ¶åˆ·æ–°ï¼Œè®“ checkUserStatus é‡æ–°å¾é›²ç«¯æŠ“å–æ–°å¸³è™Ÿçš„æ‰€æœ‰è³‡æ–™
          location.reload();
        }
      } catch (e) {
        console.error("å¼•ç¹¼å‡ºéŒ¯:", e);
        alert("é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹ã€‚");
      }
    }
    //æ”¹å
    function changePlayerName() {
      const changeNameFee = 100000000;
      const playerId = localStorage.getItem('player_id');
      const balance = parseFloat(localStorage.getItem('sicbo_balance')) || 0;
      const currentName = localStorage.getItem('player_name') || "ç„¡åæ°";

      if (!playerId) return alert("è«‹å…ˆç™»å…¥éŠæˆ²ï¼");

      // å»ºç«‹æ”¹åå½ˆçª—
      const modal = document.createElement('div');
      modal.id = 'name-change-modal';
      modal.style = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); display: flex; align-items: center;
        justify-content: center; z-index: 100000; font-family: sans-serif;
    `;

      modal.innerHTML = `
        <div style="width: 85%; max-width: 320px; background: #222; border: 2px solid gold; border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.5);">
            <h3 style="color: gold; margin-top: 0;">ä¿®æ”¹æš±ç¨±</h3>
            <p style="font-size: 14px; color: #ccc;">è²»ç”¨ï¼šğŸ’ ${(changeNameFee / 100000000)} å„„</p>
            
            <input type="text" id="newNameInput" value="${currentName}" maxlength="8" 
                style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #444; background: #333; color: white; text-align: center; font-size: 16px; margin: 15px 0; box-sizing: border-box;">
            
            <div style="display: flex; gap: 10px;">
                <button id="cancelBtn" style="flex: 1; padding: 10px; border-radius: 10px; border: none; background: #555; color: white;">å–æ¶ˆ</button>
                <button id="confirmBtn" style="flex: 1; padding: 10px; border-radius: 10px; border: none; background: var(--red, #c0392b); color: white; font-weight: bold;">ç¢ºèªä¿®æ”¹</button>
            </div>
        </div>
    `;

      document.body.appendChild(modal);

      // æŒ‰éˆ•é‚è¼¯
      document.getElementById('cancelBtn').onclick = () => modal.remove();

      document.getElementById('confirmBtn').onclick = async () => {
        const newName = document.getElementById('newNameInput').value.trim();

        if (!newName || newName === currentName) {
          modal.remove();
          return;
        }
        if (newName.length > 8) return alert("æš±ç¨±å¤ªé•·å›‰ï¼");
        if (balance < changeNameFee) return alert("é¤˜é¡ä¸è¶³ï¼");

        // åŸ·è¡Œæ›´æ–°
        try {
          const finalBalance = balance - changeNameFee;
          await db.collection("users").doc(playerId).update({
            name: newName,
            balance: finalBalance
          });

          localStorage.setItem('sicbo_balance', finalBalance);
          localStorage.setItem('player_name', newName);

          updateMainBalance();
          checkUserStatus(); // åˆ·æ–°é¦–é é¡¯ç¤º

          alert("æ”¹åæˆåŠŸï¼");
          modal.remove();
        } catch (e) {
          console.error(e);
          alert("ç³»çµ±éŒ¯èª¤");
        }
      };
    }

    async function handleDeposit(amt) {
      const playerId = localStorage.getItem('player_id');
      if (!playerId) return alert("è«‹å…ˆç™»å…¥éŠæˆ²ï¼");

      // 1. å–å¾—ä»Šå¤©æ—¥æœŸå­—ä¸² (æ ¼å¼ä¾‹å¦‚: "2025-12-29")
      const today = new Date().toISOString().split('T')[0];

      try {
        // 2. æª¢æŸ¥é›²ç«¯ç´€éŒ„
        const userRef = db.collection("users").doc(playerId);
        const doc = await userRef.get();

        if (doc.exists) {
          const userData = doc.data();
          // å¦‚æœé›²ç«¯å­˜çš„æ—¥æœŸè·Ÿä»Šå¤©ä¸€æ¨£ï¼Œå°±æ“‹ä½
          //if (userData.lastDepositDate === today) {
          // alert("ä»Šå¤©å·²ç¶“åˆ·éå›‰ï¼Œæ˜å¤©å†ä¾†");
          //closeModal();
          // return;
          //}
        }

        // 3. åŸ·è¡Œå„²å€¼é‚è¼¯
        balance = parseFloat(localStorage.getItem('sicbo_balance')) || 0;
        balance += amt;

        // 4. åŒæ­¥æ›´æ–°æœ¬åœ°èˆ‡é›²ç«¯ (å­˜å…¥ä»Šå¤©æ—¥æœŸ)
        localStorage.setItem('sicbo_balance', balance);
        await userRef.update({
          balance: balance,
          lastDepositDate: today // ç´€éŒ„ä»Šå¤©å·²é ˜å–
        });

        // 5. UI å›é¥‹
        document.getElementById('sndCash').play().catch(() => { });
        updateMainBalance();
        const toast = document.getElementById('toast-msg');
        toast.style.display = 'block';
        setTimeout(() => { toast.style.display = 'none'; }, 1500);
      } catch (e) {
        console.error("å„²å€¼å¤±æ•—:", e);
        alert("é€£ç·šä¸ç©©å®šï¼Œè«‹ç¨å¾Œå†è©¦");
      }
    }
    // å•†å“å®šç¾©
    const SHOP_DATA = {
      title: [
        { id: 't_new', name: 'ğŸŒ±åˆå‡ºèŒ…å»¬', price: 50000 },
        { id: 't_hunter', name: 'ğŸ¹è³­å ´çµäºº', price: 200000 },
        { id: 't_rich', name: 'ğŸ’°åœŸè±ª', price: 1000000 },
        { id: 't_lady', name: 'ğŸ‘—åƒé‡‘å¤§å°å§', price: 5000000 },
        { id: 't_lucky', name: 'ğŸŒŸå¹¸é‹æ˜Ÿ', price: 100000000 },
        { id: 't_sir', name: 'ğŸ©è±ªé–€å¤§å°‘çˆº', price: 5000000 },
        { id: 't_king', name: 'ğŸ‘‘æ¢Ÿé›„', price: 10000000 },
        { id: 't_shit', name: 'ğŸ’©ç‹—å±é‹', price: 30000000 },
        { id: 't_legend', name: 'ğŸ‰è³­åŸå‚³å¥‡', price: 50000000 },
        { id: 't_red', name: 'ğŸ§§é´»é‹ç•¶é ­', price: 50000000 },
        { id: 't_sleep', name: 'ğŸ’¤ èººå¹³å¤§å¸«', price: 100000000 },
        { id: 't_god', name: 'âš–ï¸å¯Œå¯æ•µåœ‹', price: 100000000 },
        { id: 't_beauty', name: 'ğŸ§šå¯æ„›ç¾éº—å°ä»™å¥³', price: 200000000 },
        { id: 't_sky', name: 'ğŸ€å¤©é¸ä¹‹äºº', price: 500000000 },
        { id: 't_world', name: 'ğŸªè³­ç¥', price: 500000000 },
        { id: 'e_ultimate', name: 'ğ’‚è‡³å°Š', price: 500000000, class: 'fx-ultimate-legend' },
        { id: 't_koi', name: 'ğŸŒŒå¹¸é‹éŒ¦é¯‰', price: 0, lottoOnly: true }
      ],
      effect: [
        { id: 'e_thunder', name: 'âš¡ é›»é–ƒé›·é³´', price: 20000000, class: 'fx-thunder' },
        { id: 'e_void', name: 'ğŸŒ€ æ¹®æ»…é»‘æ´', price: 50000000, class: 'fx-void' },
        { id: 'e_gold', name: 'âœ¨ é»ƒé‡‘å‘¼å¸', price: 80000000, class: 'fx-gold' },
        { id: 'e_lightning', name: 'âš¡ æš—å½±é›·é›»', price: 100000000, class: 'fx-lightning' },
        { id: 'e_fire', name: 'ğŸ”¥ åœ°ç„ç«', price: 200000000, class: 'fx-fire' },
        { id: 'e_ice', name: 'â„ï¸ çµ•å°é›¶åº¦', price: 200000000, class: 'fx-ice' },
        { id: 'e_neon', name: 'ğŸŒˆ å½©è™¹æ¥µå…‰', price: 500000000, class: 'fx-neon' },
        { id: 'e_hacker', name: 'ğŸ’» é§­å®¢ä»»å‹™', price: 500000000, class: 'fx-hacker' },
        { id: 'e_nebula', name: 'ğŸŒŒ å»£é—Šæ˜Ÿé›²', price: 500000000, class: 'fx-nebula' },
        { id: 'e_timelord', name: 'â³ æ™‚å…‰é ˜åŸŸ', price: 500000000, class: 'fx-timelord' },
        { id: 'e_god_king', name: 'ğŸ”± çœ¾ç¥ä¹‹å·”', price: 1000000000, class: 'fx-god-king' },
        { id: 'e_ultimate', name: 'ğ’‚ å‚³å¥‡è‡³å°Š', price: 1000000000, class: 'fx-ultimate-legend' },
        { id: 'e_koi', name: 'ğŸŒŠ éŒ¦é¯‰èºé·', price: 0, class: 'fx-cosmic-koi', lottoOnly: true }
      ]
    };
    const PET_TEMPLE_DATA = {
      pets: [
        { id: 'p_cat_1', name: 'ğŸ¾ å˜Ÿå˜Ÿè²“', price: 1000000000, img: 'basic.png', desc: 'å¥½é‹çš„é–‹ç«¯' },
        { id: 'p_cat_2', name: 'ğŸ•¶ï¸ å¿è€…å˜Ÿ', price: 10000000000, img: 'ninja.png', desc: 'ä¸Šå¿è€…èª²' },
        { id: 'p_cat_3', name: 'ğŸ’° æ‹›è²¡å˜Ÿ', price: 10000000000, img: 'money.png', desc: 'ä¾†è²¡' },
        { id: 'p_cat_4', name: 'ğŸ„ ç‘ªè‰å˜Ÿ', price: 10000000000, img: 'mario.png', desc: 'è¶…ç´šç‘ªè‰å˜Ÿ' },
        { id: 'p_cat_5', name: 'ğŸ§£ å°ç´…è²“', price: 10000000000, img: 'red.png', desc: 'å°ç´…è²“' },
        { id: 'p_cat_6', name: 'ğŸª„ éº»æ³•å˜Ÿ', price: 10000000000, img: 'magic.png', desc: 'éº»ç“œå˜Ÿå˜Ÿ' },
        { id: 'p_cat_7', name: 'â˜” é›¨å‚˜å˜Ÿ', price: 10000000000, img: 'rain.png', desc: 'ä¸‹é›¨äº†' },
        { id: 'p_cat_8', name: 'ğŸ›¸ å¤ªç©ºå˜Ÿ', price: 10000000000, img: 'space.png', desc: 'å‡ºçƒç©ç©' },
        { id: 'p_cat_9', name: 'ğŸ§¸ ç©å…·å˜Ÿ', price: 10000000000, img: 'toyz.png', desc: 'ç©å…·å¤ªå°‘äº†' },
        { id: 'p_cat_10', name: 'ğŸ‘‘ çš‡å¸å˜Ÿ', price: 10000000000, img: 'king.png', desc: 'å¾å˜Ÿè¬æ­²' }
      ],
      backgrounds: [
        { id: 'bg_default', name: 'ğŸ  æº«é¦¨è²“çª©', price: 0, img: 'bg-basic.jpg' },
        { id: 'bg_neon', name: 'ğŸŒƒ éœ“è™¹è³­åŸ', price: 5000000000, img: 'bg-city.jpg' },
        { id: 'bg_cute', name: 'ğŸš‚ å¯æ„›å°å±‹', price: 5000000000, img: 'bg-room.jpg' },
        { id: 'bg_toyz', name: 'ğŸ§© ç©å…·æ­·éšª', price: 5000000000, img: 'bg-toyzspace.jpg' },
        { id: 'bg_gold', name: 'ğŸ’° é»ƒé‡‘æ®¿å ‚', price: 5000000000, img: 'bg-gold.jpg' }
      ]
    };
    let currentShopTab = 'title';
    const LOTTO_CONFIG = {
      price: 10000000,
      grandPrize: 100000000, // 1å„„
      chanceMoney: 0.05,    // 1% ä¸­ä¸€å„„
      chanceTitle: 0.01,    // 2% ä¸­ç¨±è™Ÿ "ğŸŒŒ å¹¸é‹éŒ¦é¯‰"
      chanceFx: 0.005,       // 1.5% ä¸­ç‰¹æ•ˆ "fx-cosmic-koi"
    };
    function showLottoAnimation(results) {
      const modal = document.getElementById('lottoModal');
      const area = document.getElementById('lottoResultArea');
      area.innerHTML = "";
      modal.style.display = "flex";

      if (results.length === 0) {
        area.innerHTML = "<div class='lotto-item' style='color:#999;'>ğŸ˜¢ å…¨éƒ¨æ§“é¾œï¼Œæ˜å¤©åŠ æ²¹</div>";
      } else {
        results.forEach((text, index) => {
          setTimeout(() => {
            const div = document.createElement('div');
            div.className = 'lotto-item';
            div.innerHTML = text;
            area.appendChild(div);
            // å¦‚æœä¸­äº†è¶…å¤§çï¼Œè§¸ç™¼æ‰‹æ©Ÿéœ‡å‹• (Vibration API)
            if (window.navigator.vibrate) window.navigator.vibrate([100, 50, 100]);
          }, index * 800); // æ¯å€‹çé …é–“éš” 0.8 ç§’å‡ºç¾
        });
      }
    }

    function closeLottoModal() {
      document.getElementById('lottoModal').style.display = "none";
    }
    async function playLotto() {
      const today = new Date().toDateString();
      const now = Date.now();
      const ONE_WEEK_MS = 7 * 24 * 60 * 60 * 1000; // 7å¤©æœŸé™

      let balance = parseFloat(localStorage.getItem('sicbo_balance')) || 0;
      const playerId = localStorage.getItem('player_id');

      if (!playerId) return alert("è«‹å…ˆç™»å…¥éŠæˆ²ï¼");
      if (localStorage.getItem('lastLottoDate') === today) {
        alert("ä»Šæ—¥å·²åƒèˆ‡éæŠ•æ³¨ï¼Œè«‹æ˜æ—¥å†è©¦ï¼");
        return;
      }

      if (balance < 10000000) {
        alert("é¤˜é¡ä¸è¶³ 1åƒè¬ï¼");
        return;
      }

      if (!confirm("ç¢ºå®šè¦èŠ±è²» 1åƒè¬ åƒåŠ æ¯æ—¥å¤§æ¨‚é€å—ï¼Ÿ")) return;

      balance -= 10000000;
      localStorage.setItem('lastLottoDate', today);
      localStorage.setItem('sicbo_balance', balance);
      updateMainBalance();

      let results = [];
      let updates = { balance: balance, lastLottoDate: today };

      if (Math.random() < 0.03) {
        balance += 100000000;
        updates.balance = balance;
        localStorage.setItem('sicbo_balance', balance);
        results.push("ğŸ’° 1å„„å…ƒå¤§ç");
      }

      if (Math.random() < 0.01) {
        updates[`assets.t_koi`] = now;
        results.push("ğŸŒŒ é™å®šç¨±è™Ÿï¼šå¹¸é‹éŒ¦é¯‰");
      }

      if (Math.random() < 0.005) {
        updates[`assets.e_koi`] = now;
        results.push("ğŸŒŠ é™å®šç‰¹æ•ˆï¼šéŒ¦é¯‰èºé·");
      }

      try {
        await db.collection("users").doc(playerId).update(updates);

        // æ›´æ–°æœ¬åœ°ç«¯éæœŸæ™‚é–“ç‚º 7 å¤©
        let myAssets = JSON.parse(localStorage.getItem('my_assets') || '{}');
        if (updates[`assets.t_koi`]) myAssets['t_koi'] = now + ONE_WEEK_MS;
        if (updates[`assets.e_koi`]) myAssets['e_koi'] = now + ONE_WEEK_MS;
        localStorage.setItem('my_assets', JSON.stringify(myAssets));

        showLottoAnimation(results);
        updateMainBalance();
        if (results.length > 0) renderShop();
      } catch (error) {
        console.error("æ¨‚é€æ›´æ–°å¤±æ•—:", error);
      }
    }

    function switchShop(tab) {
      currentShopTab = tab;
      document.getElementById('tabTitle').style.background = tab === 'title' ? 'var(--red)' : '#444';
      document.getElementById('tabEffect').style.background = tab === 'effect' ? 'var(--red)' : '#444';
      renderShop();
    }

    function renderShop() {
      const shopList = document.getElementById('shopList');
      const myItems = JSON.parse(localStorage.getItem('my_assets') || '{}');
      const currentEquipped = JSON.parse(localStorage.getItem('equipped_assets') || '{"title":"","effect":""}');
      const now = Date.now();

      let html = '';
      SHOP_DATA[currentShopTab].forEach(item => {
        const expiry = myItems[item.id] || 0;
        const isOwned = now < expiry;
        const isEquipped = (currentShopTab === 'title' ? currentEquipped.title : currentEquipped.effect) === item.id;
        const isLottoOnly = item.lottoOnly === true;

        // 1. åˆ¤æ–· Class
        const previewClass = (currentShopTab === 'effect' && item.class) ? item.class : "";

        // 2. ä¿®æ”¹é€™è£¡ï¼šè£œä¸Š z-index: 1 ä»¥åŠèª¿æ•´ padding è®“ç‰¹æ•ˆæµå…‰æœ‰ç©ºé–“è·‘
        const previewStyle = (currentShopTab === 'effect') ?
          "padding: 15px; border-radius: 25px; margin-bottom: 5px; text-align: center; font-weight: bold; position: relative; overflow: hidden; contain: paint; z-index: 1; display: block; width: 100%; box-sizing: border-box;" : "";

        let priceDisplay = '';
        let actionButton = '';

        if (isOwned) {
          const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
          priceDisplay = daysLeft > 10000 ? 'âŒ› æ°¸ä¹…æ“æœ‰' : `â³ å‰©é¤˜: ${daysLeft} å¤©`;
          actionButton = `<button class="equip-btn" onclick="equipAsset('${currentShopTab}', '${item.id}')">${isEquipped ? 'âœ… ä½¿ç”¨ä¸­' : 'è£å‚™'}</button>`;
        } else if (isLottoOnly) {
          priceDisplay = `<span style="color:var(--gold); font-weight:bold;">ğŸ° å¤§æ¨‚é€é™å®š</span>`;
          actionButton = `<button class="buy-btn" style="background:#555; cursor:not-allowed; opacity:0.7;" disabled>éè³£å“</button>`;
        } else {
          priceDisplay = `åƒ¹æ ¼: ğŸ’ ${item.price.toLocaleString()}`;
          actionButton = `<button class="buy-btn" onclick="buyAsset('${currentShopTab}', '${item.id}', ${item.price})">ğŸ›’ è³¼è²·</button>`;
        }
        html += `
<div style="border:1px solid #444; padding:12px; margin-bottom:12px; border-radius:15px; background:rgba(0,0,0,0.5); transition: 0.3s;">
  <div class="${previewClass}" style="${previewStyle}">
    <span style="color:var(--gold); font-weight:bold; font-size: 16px; position:relative; z-index:2;">${item.name}</span>
    ${currentShopTab === 'effect' ? '<div style="font-size:10px; opacity:0.8;"></div>' : ''}
  </div>
          
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
            <div style="text-align:left;">
              <div style="color:#aaa; font-size:11px; margin-top:5px;">
                ${priceDisplay}
              </div>
            </div>
            <div>
              ${actionButton}
            </div>
          </div>
        </div>`;
      });
      shopList.innerHTML = html;
    }

    // è³¼è²·èˆ‡è£å‚™é‚è¼¯
    async function buyAsset(type, id, price) {
      let balance = parseFloat(localStorage.getItem('sicbo_balance')) || 0;
      if (balance < price) return alert("éŒ¢ä¸å¤ ï¼ä¸å€ŸéŒ¢å–”ï¼");
      if (!confirm("ç¢ºå®šè³¼è²· 7 å¤©ä½¿ç”¨æ¬Šå—ï¼Ÿ")) return;

      balance -= price;
      const expiry = Date.now() + (7 * 24 * 60 * 60 * 1000);

      // æ›´æ–°æœ¬åœ°
      let myAssets = JSON.parse(localStorage.getItem('my_assets') || '{}');
      myAssets[id] = expiry;
      localStorage.setItem('my_assets', JSON.stringify(myAssets));
      localStorage.setItem('sicbo_balance', balance);

      // åŒæ­¥ Firebase
      const playerId = localStorage.getItem('player_id');
      if (playerId) {
        await db.collection("users").doc(playerId).update({
          balance: balance,
          assets: myAssets
        });
      }

      updateMainBalance();
      renderShop();
      alert("è³¼è²·æˆåŠŸï¼");
    }

    async function equipAsset(type, id) {
      let equipped = JSON.parse(localStorage.getItem('equipped_assets') || '{"title":"","effect":""}');
      equipped[type] = id;
      localStorage.setItem('equipped_assets', JSON.stringify(equipped));

      // åŒæ­¥åˆ°æ’è¡Œæ¦œèˆ‡é¡¯ç¤º
      const playerId = localStorage.getItem('player_id');
      if (playerId) {
        // é€™è£¡æˆ‘å€‘æŠŠç¨±è™Ÿèˆ‡ç‰¹æ•ˆçš„ class å­˜å…¥ Firebase
        const titleObj = SHOP_DATA.title.find(t => t.id === equipped.title);
        const effectObj = SHOP_DATA.effect.find(e => e.id === equipped.effect);

        const updateData = {
          equipped_title: titleObj ? titleObj.name : "",
          equipped_fx: effectObj ? effectObj.class : ""
        };

        await db.collection("users").doc(playerId).update(updateData);
      }

      renderShop();
      loadRanking();
      alert("è£å‚™æˆåŠŸï¼");
      checkUserStatus();
    }
    // æ’è¡Œæ¦œé¡¯ç¤ºåˆ‡æ›
    async function toggleRank() {
      const sidebar = document.getElementById('rankSidebar');
      const overlay = document.getElementById('rankOverlay');

      if (sidebar.classList.contains('active')) {
        sidebar.classList.remove('active');
        overlay.style.display = 'none';
      } else {
        sidebar.classList.add('active');
        overlay.style.display = 'block';
        loadRanking(); // é–‹å•Ÿæ™‚æŠ“å–æœ€æ–°æ’å
      }
    }

    // å¾ Firebase æŠ“å–å‰ 10 å
    async function loadRanking() {
      const rankList = document.getElementById('rankList');
      try {
        const snapshot = await db.collection("users").orderBy("balance", "desc").limit(10).get();
        let html = '';
        let i = 1;
        const now = Date.now(); // å–å¾—ç•¶å‰æ™‚é–“

        snapshot.forEach(doc => {
          const data = doc.data();
          const userAssets = data.assets || {}; // å–å¾—è©²ç©å®¶çš„æ‰€æœ‰è³‡ç”¢åˆ°æœŸæ—¥

          // --- æ ¸å¿ƒä¿®æ”¹ï¼šç¨±è™ŸéæœŸåˆ¤æ–· ---
          let titleText = data.equipped_title || "";
          if (titleText) {
            const titleObj = SHOP_DATA.title.find(t => t.name === titleText);
            // å¦‚æœæ‰¾ä¸åˆ°è©²ç¨±è™Ÿ IDï¼Œæˆ–è€…ç¾åœ¨æ™‚é–“å·²è¶…éåˆ°æœŸæ—¥ï¼Œå°±æ¸…ç©ºä¸é¡¯ç¤º
            if (titleObj && userAssets[titleObj.id] && now > userAssets[titleObj.id]) {
              titleText = "";
            }
          }

          // --- æ ¸å¿ƒä¿®æ”¹ï¼šç‰¹æ•ˆéæœŸåˆ¤æ–· ---
          let fxClass = data.equipped_fx || "";
          if (fxClass) {
            const effectObj = SHOP_DATA.effect.find(e => e.class === fxClass);
            // å¦‚æœç¾åœ¨æ™‚é–“å·²è¶…éåˆ°æœŸæ—¥ï¼Œå°±æ¸…ç©º Class
            if (effectObj && userAssets[effectObj.id] && now > userAssets[effectObj.id]) {
              fxClass = "";
            }
          }

          // --- ä»¥ä¸‹ç¶­æŒä½ åŸæœ¬çš„é¡è‰²åˆ¤æ–·èˆ‡ HTML ç”Ÿæˆ ---
          let titleColorClass = "t-blue";
          if (titleText.includes("å¹¸é‹éŒ¦é¯‰")) titleColorClass = "t-koi-color";
          else if (titleText.includes("è³­ç¥") || titleText.includes("å¯Œå¯æ•µåœ‹") || titleText.includes("è‡³å°Š") || titleText.includes("èººå¹³")) titleColorClass = "t-red";
          else if (titleText.includes("æ¢Ÿé›„") || titleText.includes("å‚³å¥‡") || titleText.includes("é´»é‹") || titleText.includes("å¤©é¸")) titleColorClass = "t-orange";
          else if (titleText.includes("åœŸè±ª") || titleText.includes("åƒé‡‘") || titleText.includes("ç‹—å±") || titleText.includes("å°‘çˆº") || titleText.includes("ä»™å¥³")) titleColorClass = "t-purple";
          else if (titleText.includes("å¹¸é‹")) titleColorClass = "t-yellow";

          const titleHTML = titleText ? `<span class="player-title ${titleColorClass}">ã€${titleText}ã€‘</span>` : "";

          html += `
                <div class="rank-item ${fxClass}">
                  <div class="rank-info">
                    <span class="rank-num">${i === 1 ? 'ğŸ†' : i}</span>
                    <span class="rank-name">${titleHTML}${data.name || 'ç„¡åæ°'}</span>
                  </div>
                  <span class="rank-bal">ğŸ’${Math.floor(data.balance).toLocaleString()}</span>
                </div>
            `;
          i++;
        });
        rankList.innerHTML = html || '<p style="text-align:center; color:#888;">å°šç„¡æ’åæ•¸æ“š</p>';
      } catch (e) {
        console.error("è¼‰å…¥æ’è¡Œæ¦œå¤±æ•—:", e);
        rankList.innerHTML = '<p style="text-align:center; color:red;">è¼‰å…¥å¤±æ•—</p>';
      }
    }
    async function checkUserStatus() {
      let playerId = localStorage.getItem('player_id');
      if (!playerId || playerId === "null") {
        document.getElementById('nameModal').style.display = 'flex';
        updateMainBalance();
        return;
      }

      try {
        const doc = await db.collection("users").doc(playerId).get();
        if (doc.exists) {
          const cloudData = doc.data();
          const now = Date.now();
          const myAssets = cloudData.assets || {};

          // --- [æ–°å¢é€™æ®µï¼šç¢ºä¿å¼•ç¹¼å¾Œçš„è³‡ç”¢åŒæ­¥åˆ°æœ¬åœ°] ---
          localStorage.setItem('my_assets', JSON.stringify(myAssets));

          const localEquipped = { title: "", effect: "" };
          if (cloudData.equipped_title) {
            const tObj = SHOP_DATA.title.find(t => t.name === cloudData.equipped_title);
            if (tObj) localEquipped.title = tObj.id;
          }
          if (cloudData.equipped_fx) {
            const eObj = SHOP_DATA.effect.find(e => e.class === cloudData.equipped_fx);
            if (eObj) localEquipped.effect = eObj.id;
          }
          localStorage.setItem('equipped_assets', JSON.stringify(localEquipped));
          // ------------------------------------------

          // --- 1. è‡ªå‹•æª¢æŸ¥ç¨±è™Ÿèˆ‡ç‰¹æ•ˆæ˜¯å¦éæœŸ (ä½ åŸæœ¬çš„é‚è¼¯) ---
          let currentTitle = cloudData.equipped_title || "";
          let currentFx = cloudData.equipped_fx || "";
          let needUpdateCloud = false;

          const titleObj = SHOP_DATA.title.find(t => t.name === currentTitle);
          const effectObj = SHOP_DATA.effect.find(e => e.class === currentFx);

          if (titleObj && myAssets[titleObj.id] && now > myAssets[titleObj.id]) {
            currentTitle = "";
            needUpdateCloud = true;
          }
          if (effectObj && myAssets[effectObj.id] && now > myAssets[effectObj.id]) {
            currentFx = "";
            needUpdateCloud = true;
          }

          if (needUpdateCloud) {
            await db.collection("users").doc(playerId).update({
              equipped_title: currentTitle,
              equipped_fx: currentFx
            });
            const lEquip = JSON.parse(localStorage.getItem('equipped_assets') || '{}');
            if (currentTitle === "") lEquip.title = "";
            if (currentFx === "") lEquip.effect = "";
            localStorage.setItem('equipped_assets', JSON.stringify(lEquip));
          }

          // --- 2. é¤˜é¡åŒæ­¥é‚è¼¯ (ä½ åŸæœ¬çš„é‚è¼¯) ---
          const localBal = parseFloat(localStorage.getItem('sicbo_balance')) || 0;
          const cloudBal = cloudData.balance;
          localStorage.setItem('player_name', cloudData.name);

          // åªè¦é›²ç«¯éŒ¢ä¸ç­‰æ–¼æœ¬åœ°ï¼Œå¼•ç¹¼æ™‚æœƒä»¥é›²ç«¯ç‚ºä¸»
          if (cloudBal !== undefined && cloudBal > localBal) {
            localStorage.setItem('sicbo_balance', cloudBal);
          } else if (cloudBal !== undefined && localBal > cloudBal) {
            await db.collection("users").doc(playerId).update({ balance: localBal });
          }

          // --- 3. æ¸²æŸ“ UI é¡¯ç¤º (ä½ åŸæœ¬çš„é‚è¼¯) ---
          const welcomeEl = document.getElementById('welcomeUser');
          welcomeEl.innerHTML = "";
          welcomeEl.className = "welcome-msg";

          const textWrapper = document.createElement('span');
          textWrapper.style.position = "relative";
          textWrapper.style.zIndex = "5";

          if (currentTitle) {
            const titleSpan = document.createElement('span');
            titleSpan.textContent = `ã€${currentTitle}ã€‘`;
            titleSpan.className = "player-title";
            const titleText = currentTitle;

            if (titleText.includes("å¹¸é‹éŒ¦é¯‰")) titleSpan.classList.add("t-koi-color");
            else if (titleText.includes("è³­ç¥") || titleText.includes("å¯Œå¯æ•µåœ‹") || titleText.includes("è‡³å°Š") || titleText.includes("èººå¹³")) titleSpan.classList.add("t-red");
            else if (titleText.includes("æ¢Ÿé›„") || titleText.includes("å‚³å¥‡") || titleText.includes("é´»é‹") || titleText.includes("å¤©é¸")) titleSpan.classList.add("t-orange");
            else if (titleText.includes("åœŸè±ª") || titleText.includes("åƒé‡‘") || titleText.includes("ç‹—å±") || titleText.includes("å°‘çˆº") || titleText.includes("ä»™å¥³")) titleSpan.classList.add("t-purple");
            else if (titleText.includes("å¹¸é‹")) titleSpan.classList.add("t-yellow");
            else titleSpan.classList.add("t-blue");

            textWrapper.appendChild(titleSpan);
          }

          const nameSpan = document.createElement('span');
          nameSpan.textContent = cloudData.name || "ç„¡åæ°";
          textWrapper.appendChild(nameSpan);
          welcomeEl.appendChild(textWrapper);

          if (currentFx) {
            welcomeEl.classList.add(currentFx);
            welcomeEl.style.display = "inline-block";
            welcomeEl.style.padding = "8px 25px";
            welcomeEl.style.borderRadius = "25px";
          }

          updateMainBalance();
        } else {
          document.getElementById('nameModal').style.display = 'flex';
        }
      } catch (e) {
        console.error("Firebase é€£ç·šå¤±æ•—", e);
        updateMainBalance();
      }
    }
    // --- å•†åŸåŠŸèƒ½ ---
    function openShop() { document.getElementById('shopModal').style.display = 'flex'; }
    function closeShop() { document.getElementById('shopModal').style.display = 'none'; }

    async function buyTitle(titleName, price) {
      let balance = parseFloat(localStorage.getItem('sicbo_balance')) || 0;
      if (balance < price) return alert("éŒ¢ä¸å¤ å•¦");
      if (!confirm(`ç¢ºå®šè¦èŠ±è²» ğŸ’ ${price.toLocaleString()} è³¼è²·ã€Œ${titleName}ã€å—ï¼Ÿ`)) return;

      balance -= price;
      localStorage.setItem('sicbo_balance', balance);

      const playerId = localStorage.getItem('player_id');
      if (playerId) {
        try {
          // é—œéµä¿®æ”¹ï¼šåªæ›´æ–° equipped_titleï¼Œä¸æ”¹å‹• name æ¬„ä½
          await db.collection("users").doc(playerId).update({
            balance: balance,
            equipped_title: titleName
          });
          alert("è³¼è²·æˆåŠŸï¼ç¨±è™Ÿå·²æ›´æ–°ã€‚");
        } catch (e) {
          console.error("å•†åŸæ›´æ–°å¤±æ•—", e);
        }
      }
      updateMainBalance();
      closeShop();
      checkUserStatus(); // ç«‹å³é‡æ–°æ•´ç†é¡¯ç¤º
      loadRanking();
    }
    // --- é—œéµä¿®å¾©ï¼šå„²å­˜æš±ç¨± ---
    async function saveNewPlayer() {
      const nameInput = document.getElementById('nicknameInput');
      const name = nameInput.value.trim();
      if (!name) return alert("è«‹è¼¸å…¥åå­—ï¼");

      // 1. å¼·åˆ¶é‡æ–°ç²å–ä¸€æ¬¡ IDï¼Œå¦‚æœæ²’æœ‰å°±åœ°ç”Ÿæˆ
      let playerId = localStorage.getItem('player_id');
      if (!playerId || playerId === "" || playerId === "null") {
        playerId = 'u' + Date.now() + Math.floor(Math.random() * 1000);
        localStorage.setItem('player_id', playerId);
      }

      const localBal = parseFloat(localStorage.getItem('sicbo_balance')) || 5000;

      try {
        // 2. å…ˆå­˜æœ¬åœ°ï¼Œç¢ºä¿ UI èƒ½å…ˆå‹•
        localStorage.setItem('player_name', name);
        localStorage.setItem('sicbo_balance', localBal);

        // 3. åŸ·è¡Œ Firebase å¯«å…¥ (æ­¤æ™‚ playerId çµ•å°æœ‰å€¼)
        await db.collection("users").doc(playerId).set({
          name: name,
          balance: localBal,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        document.getElementById('nameModal').style.display = 'none';
        document.getElementById('welcomeUser').textContent = `æ­¡è¿ï¼Œ${name}`;
        updateMainBalance();
      } catch (e) {
        console.error("å„²å­˜å¤±æ•—:", e);
        // è¬ä¸€ Firebase çœŸçš„é‚„æ˜¯å¤±æ•—ï¼Œè‡³å°‘è¦è®“ç©å®¶é—œæ‰è¦–çª—é€²å…¥éŠæˆ²
        document.getElementById('nameModal').style.display = 'none';
        document.getElementById('welcomeUser').textContent = `æ­¡è¿(æœ¬åœ°)ï¼Œ${name}`;
        updateMainBalance();
      }
    }
    // é–‹å•Ÿè²“å’ªç¥æ®¿é é¢
   async function openPetTemple() {
    const playerId = localStorage.getItem('player_id');
    if (!playerId) return alert("è«‹å…ˆç™»å…¥éŠæˆ²ï¼");

    try {
        const doc = await db.collection("users").doc(playerId).get();
        if (!doc.exists) return;
        const userData = doc.data();

        // ã€ä¿®æ­£ 1ã€‘å¢åŠ é˜²è­·ï¼Œç¢ºä¿ petSys çš„æ‰€æœ‰å±¬æ€§éƒ½å­˜åœ¨ï¼Œé¿å…è®€å– undefined å ±éŒ¯
        const petSys = userData.pet_system || {};
        const currentPetId = petSys.current_pet_id || "";
        const unlockedPets = petSys.unlocked_pets || [];
        const currentBgId = petSys.current_bg_id || "bg_default";
        const unlockedBgs = petSys.unlocked_bgs || ["bg_default"];

        // ã€ä¿®æ­£ 2ã€‘åŠ ä¸Š ?. ç¢ºä¿æ‰¾ä¸åˆ°ç‰©ä»¶æ™‚ä¸æœƒå°è‡´æ•´å€‹ JS å´©æ½°
        const currentPetObj = PET_TEMPLE_DATA.pets.find(p => p.id === currentPetId);
        const currentBgObj = PET_TEMPLE_DATA.backgrounds.find(b => b.id === currentBgId);

        let petDisplayHTML = '';
        let petNameHTML = '';

        if (currentPetObj && currentPetObj.img) {
            petDisplayHTML = `<img src="assets/pet/${currentPetObj.img}" style="width:220px; filter: drop-shadow(0 0 20px gold);">`;
            petNameHTML = `âœ¨ ${currentPetObj.name}`;
        } else {
            petDisplayHTML = `<div style="width:180px; height:180px; border:2px dashed #888; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#ccc; background:rgba(0,0,0,0.3);">å°šæœªé ˜é¤Šè²“å’ª</div>`;
            petNameHTML = `è«‹æ–¼ä¸‹æ–¹é ˜é¤Šè²“å’ª`;
        }

        const bgPath = `assets/pet/${currentBgObj?.img || "bg_basic.jpg"}`;

        const oldOverlay = document.getElementById('pet-temple-overlay');
        if (oldOverlay) oldOverlay.remove();

        const overlay = document.createElement('div');
        overlay.id = 'pet-temple-overlay';
        overlay.style = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #121212; 
            background-image: url("${bgPath}");
            background-size: cover; background-position: center;
            color: white; z-index: 99999; overflow: hidden; font-family: sans-serif;
        `;

        overlay.innerHTML = `
            <div style="height: 100%; display: flex; flex-direction: column; background: rgba(0,0,0,0.4);
                        padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); box-sizing: border-box;">
                
                <div style="padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
                    <button onclick="document.getElementById('pet-temple-overlay').remove()" style="background:rgba(0,0,0,0.5); color:white; border:1px solid #666; padding:8px 15px; border-radius:20px;">â¬… è¿”å›</button>
                    <div style="background:rgba(0,0,0,0.5); padding:5px 15px; border-radius:20px; color:gold; font-weight:bold; border:1px solid gold;">ğŸ’ ${Math.floor(userData.balance || 0).toLocaleString()}</div>
                </div>
                
                <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <h1 style="color:#ffd700; text-shadow: 0 0 15px rgba(255,215,0,0.8); margin: 0; font-size: 24px;">(æœªå®Œæˆ)è²“å’ªç¥æ®¿</h1>
                    <div id="temple-pet-display" style="margin-top: 20px;">${petDisplayHTML}</div>
                    <div style="margin-top: 15px; background:rgba(0,0,0,0.6); padding:5px 15px; border-radius:15px; font-size:14px;">${petNameHTML}</div>
                </div>

                <div style="padding: 20px; display: flex; gap: 10px; background: rgba(0,0,0,0.8); z-index: 100001; position: relative;">
                    <button onclick="window.togglePetMenu('adopt')" style="flex:1; background: #e67e22; color:white; border:none; padding:15px; border-radius:12px; font-weight:bold;">ğŸ¾ é€²åŒ–èˆ‡é ˜é¤Š</button>
                    <button onclick="window.togglePetMenu('deco')" style="flex:1; background: #2980b9; color:white; border:none; padding:15px; border-radius:12px; font-weight:bold;">ğŸ–¼ï¸ ç¥æ®¿è£æ½¢</button>
                </div>

                <div id="pet-menu-drawer" style="display:none; position:fixed; bottom:0; left:0; width:100%; background:#222; border-top:3px solid gold; border-radius:20px 20px 0 0; z-index:100002; padding:20px; box-sizing:border-box; animation: slideUp 0.3s ease;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                        <span id="menu-title" style="font-weight:bold; color:gold;"></span>
                        <span onclick="document.getElementById('pet-menu-drawer').style.display='none'" style="cursor:pointer; padding:5px; font-size:20px;">âœ•</span>
                    </div>
                    <div id="menu-content" style="display:flex; overflow-x:auto; gap:15px; padding-bottom:10px;"></div>
                </div>
            </div>
            <style> @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } } </style>
        `;
        document.body.appendChild(overlay);

        // ã€ä¿®æ­£ 3ã€‘å°‡ togglePetMenu çš„é‚è¼¯åŒ…è£¹åœ¨ try-catch è£¡ï¼Œé˜²æ­¢å ±éŒ¯å°è‡´æŒ‰éˆ•æ­»æ‰
        window.togglePetMenu = function (type) {
            try {
                const drawer = document.getElementById('pet-menu-drawer');
                const title = document.getElementById('menu-title');
                const content = document.getElementById('menu-content');

                if (drawer.style.display === 'block' && drawer.dataset.type === type) {
                    drawer.style.display = 'none';
                    return;
                }
                drawer.dataset.type = type;
                content.innerHTML = '';

                if (type === 'adopt') {
                    title.innerText = "ğŸ¾ é¸æ“‡å¤¥ä¼´";
                    content.innerHTML = PET_TEMPLE_DATA.pets.map(p => {
                        const isOwned = unlockedPets.includes(p.id);
                        const isEquipped = currentPetId === p.id;
                        return `
                        <div style="min-width:130px; background:#333; padding:15px; border-radius:12px; border:${isEquipped ? '2px solid gold' : '1px solid #555'}; text-align:center;">
                            <img src="assets/pet/${p.img}" onerror="this.src='assets/pet/basic.png'" style="width:80px; height:80px; object-fit:contain; margin-bottom:10px;">
                            <div style="font-size:12px; margin-bottom:10px;">${p.name}</div>
                            ${isOwned ? 
                                `<button onclick="actionPet('equip','${p.id}')" style="width:100%; background:${isEquipped ? '#444' : '#666'}; border:none; border-radius:5px; color:white; padding:8px 5px;">${isEquipped ? 'ä½¿ç”¨ä¸­' : 'è£å‚™'}</button>` : 
                                `<button onclick="actionPet('buy','${p.id}',${p.price})" style="width:100%; background:#c0392b; border:none; border-radius:5px; color:white; padding:8px 5px; font-size:10px;">ğŸ’${(p.price / 100000000).toLocaleString()}å„„</button>`
                            }
                        </div>`;
                    }).join('');
                } else {
                    title.innerText = "ğŸ–¼ï¸ é¸æ“‡è£æ½¢";
                    content.innerHTML = PET_TEMPLE_DATA.backgrounds.map(bg => {
                        const isOwned = unlockedBgs.includes(bg.id);
                        const isEquipped = currentBgId === bg.id;
                        return `
                        <div style="min-width:130px; background:#333; padding:15px; border-radius:12px; border:${isEquipped ? '2px solid #3498db' : '1px solid #555'}; text-align:center;">
                            <img src="assets/pet/${bg.img}" onerror="this.src='assets/pet/bg-basic.jpg'" style="width:100%; height:60px; object-fit:cover; border-radius:5px; margin-bottom:10px;">
                            <div style="font-size:12px; margin-bottom:10px;">${bg.name}</div>
                            ${isOwned ? 
                                `<button onclick="actionBg('equip','${bg.id}')" style="width:100%; background:${isEquipped ? '#444' : '#666'}; border:none; border-radius:5px; color:white; padding:8px 5px;">${isEquipped ? 'å¥—ç”¨ä¸­' : 'æ›´æ›'}</button>` : 
                                `<button onclick="actionBg('buy','${bg.id}',${bg.price})" style="width:100%; background:#2980b9; border:none; border-radius:5px; color:white; padding:8px 5px; font-size:10px;">ğŸ’${(bg.price / 100000000).toLocaleString()}å„„</button>`
                            }
                        </div>`;
                    }).join('');
                }
                drawer.style.display = 'block';
            } catch (err) {
                console.error("åˆ‡æ›é¸å–®å‡ºéŒ¯:", err);
            }
        };

    } catch (e) {
        console.error("åˆå§‹åŒ–ç¥æ®¿å‡ºéŒ¯:", e);
    }
}
    // è™•ç†è²“å’ª è³¼è²·/è£å‚™
   async function actionPet(type, id, price) {
    const playerId = localStorage.getItem('player_id');
    if (!playerId) return;

    try {
        const userRef = db.collection("users").doc(playerId);
        const doc = await userRef.get();
        if (!doc.exists) return;

        const userData = doc.data();
        // å„ªå…ˆä½¿ç”¨ Firebase çš„é¤˜é¡ï¼Œç¢ºä¿æ‰£éŒ¢é‚è¼¯çµ•å°æº–ç¢º
        let balance = userData.balance || 0;

        // ã€æ ¸å¿ƒä¿®æ­£ã€‘ç¢ºä¿ petSys å…§éƒ¨çš„æ‰€æœ‰æ¬„ä½å³ä¾¿ä¸å­˜åœ¨ï¼Œä¹Ÿæœƒè¢«åˆå§‹åŒ–ç‚ºæ­£ç¢ºæ ¼å¼
        let petSys = userData.pet_system || {};
        if (!petSys.unlocked_pets) petSys.unlocked_pets = [];
        if (!petSys.current_pet_id) petSys.current_pet_id = "";

        if (type === 'buy') {
            if (balance < price) return alert("é¤˜é¡ä¸è¶³ï¼å†è´ä¸€é»å§");
            
            // ç‚ºäº†é˜²æ­¢æ‰‹æ©Ÿé€£é»ï¼Œé€™è£¡åŠ ä¸Šç°¡å–®çš„ç¢ºèª
            if (!confirm(`è¦èŠ±è²» ğŸ’ ${(price / 100000000).toLocaleString()}å„„ é ˜é¤Šå—ï¼Ÿ`)) return;
            
            balance -= price;
            
            // å†æ¬¡æª¢æŸ¥æ˜¯å¦å·²æ“æœ‰ï¼Œé¿å…é‡è¤‡æ¨å…¥é™£åˆ—
            if (!petSys.unlocked_pets.includes(id)) {
                petSys.unlocked_pets.push(id);
            }
        }

        // ä¸è«–æ˜¯è³¼è²·é‚„æ˜¯æ›´æ›ï¼Œéƒ½æ›´æ–°ç•¶å‰ä½¿ç”¨çš„ ID
        petSys.current_pet_id = id;

        // å¯«å›è³‡æ–™åº«
        await userRef.update({
            balance: balance,
            pet_system: petSys
        });

        // åŒæ­¥æœ¬åœ°å¿«å–èˆ‡ UI
        localStorage.setItem('sicbo_balance', balance);
        if (typeof updateMainBalance === 'function') updateMainBalance();

        // é—œé–‰èˆŠé é¢ä¸¦é‡é–‹ï¼Œç¢ºä¿çœ‹åˆ°æœ€æ–°çš„è²“å’ª
        const overlay = document.getElementById('pet-temple-overlay');
        if (overlay) overlay.remove();
        
        // é‡æ–°é–‹å•Ÿç¥æ®¿é é¢
        openPetTemple();

    } catch (e) {
        console.error("é ˜é¤Šæ“ä½œå¤±æ•—:", e);
        alert("å¤±æ•—ï¼Œè«‹å›å ±");
    }
}

    // è™•ç†èƒŒæ™¯ è³¼è²·/æ›´æ›
   async function actionBg(type, id, price) {
    const playerId = localStorage.getItem('player_id');
    if (!playerId) return;

    try {
        const userRef = db.collection("users").doc(playerId);
        const doc = await userRef.get();
        if (!doc.exists) return;

        let userData = doc.data();
        let balance = userData.balance || 0;
        
        // ã€æ ¸å¿ƒä¿®æ­£ã€‘èˆ‡ä½ çš„è³‡æ–™åº«æˆªåœ–å®Œå…¨å°é½Š
        let petSys = userData.pet_system || {};
        if (!petSys.unlocked_bgs) petSys.unlocked_bgs = ["bg_default"]; 
        if (!petSys.current_bg_id) petSys.current_bg_id = "bg_default";

        if (type === 'buy') {
            if (balance < price) return alert("éŒ¢ä¸å¤ è£æ½¢å–”ï¼");
            if (!confirm(`è¦èŠ±è²» ğŸ’ ${(price / 100000000).toLocaleString()}å„„ è³¼è²·æ­¤è£æ½¢å—ï¼Ÿ`)) return;
            
            balance -= price;
            
            // ç¢ºä¿ unlocked_bgs æ˜¯ä¸€å€‹é™£åˆ—å¾Œå†æ“ä½œ
            if (!petSys.unlocked_bgs.includes(id)) {
                petSys.unlocked_bgs.push(id);
            }
        }

        // æ›´æ–°ç•¶å‰ä½¿ç”¨çš„èƒŒæ™¯ ID
        petSys.current_bg_id = id;

        // å¯«å›è³‡æ–™åº«
        await userRef.update({
            balance: balance,
            pet_system: petSys
        });

        // æ›´æ–°æœ¬åœ°é¤˜é¡
        localStorage.setItem('sicbo_balance', balance);
        if (typeof updateMainBalance === 'function') updateMainBalance();

        // å³æ™‚ UI åé¥‹
        const bgObj = PET_TEMPLE_DATA.backgrounds.find(b => b.id === id);
        const overlay = document.getElementById('pet-temple-overlay');

        if (overlay && bgObj) {
            // æ›´æ›èƒŒæ™¯åœ–
            overlay.style.backgroundImage = `url('assets/pet/${bgObj.img}')`;

            // æ›´æ–°ç•«é¢ä¸Šæ–¹çš„é¤˜é¡ (ä¿®æ­£é¸æ“‡å™¨ï¼Œç¢ºä¿èƒ½æŠ“åˆ°é¤˜é¡ div)
            const balanceDivs = overlay.querySelectorAll('div');
            for (let div of balanceDivs) {
                if (div.innerText.includes('ğŸ’')) {
                    div.innerHTML = `ğŸ’ ${Math.floor(balance).toLocaleString()}`;
                    break;
                }
            }

            // é—œé–‰é¸å–®
            const drawer = document.getElementById('pet-menu-drawer');
            if (drawer) drawer.style.display = 'none';

            if (typeof showWinToast === 'function') showWinToast("ğŸ¨ ç¥æ®¿è£æ½¢æ›´æ–°æˆåŠŸï¼");
        } else {
            // å¦‚æœ DOM ä¸åœ¨ï¼Œå°±é‡é–‹ç¥æ®¿
            openPetTemple();
        }

    } catch (e) {
        console.error("èƒŒæ™¯æ“ä½œå¤±æ•—è©³ç´°åŸå› :", e);
        alert("å¤±æ•—ï¼Œè«‹å›å ±");
    }
}

    window.onload = function () {
      updateMainBalance();
      checkUserStatus();
    };

    document.addEventListener('click', function (e) {
      let target = e.target.closest('a');
      if (target && target.href && target.getAttribute('href') !== '#') {
        e.preventDefault();
        window.location.href = target.href;
      }
    }, false);

    window.addEventListener('storage', (e) => {
      if (e.key === 'sicbo_balance') updateMainBalance();
    });
  </script>
</body>

</html>