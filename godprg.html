<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ç¥åŸŸ - æº–å‚™å‡ºæ“Š</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ç¢ºä¿æ‰‹æ©Ÿç«¯ä¸ç”¢ç”Ÿå…¨é æ²è»¸ï¼Œè§£æ±ºç¶²å€åˆ—è·³å‹•å•é¡Œ */
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; position: fixed; background: #0f172a; font-family: sans-serif; }
    #app { width: 100%; height: 100%; }
    .custom-scroll::-webkit-scrollbar { width: 4px; }
    .custom-scroll::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.3); border-radius: 10px; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // --- æ•¸æ“šå®šç¾© (ä¿æŒå®Œæ•´ï¼Œåœ–ç‰‡è·¯å¾‘æ›´æ–°) ---
    const HEROES = [
      { id: 'knight', name: 'è–é¨å£«', rarity: 'epic', attack: 120, speed: 1.2, range: 'melee', image: 'assets/hero/knight.png', unlocked: true },
      { id: 'archer', name: 'ç¥å°„æ‰‹', rarity: 'rare', attack: 80, speed: 2.0, range: 'long', image: 'assets/hero/archer.png', unlocked: true },
      { id: 'mage', name: 'å…ƒç´ æ³•å¸«', rarity: 'epic', attack: 150, speed: 0.8, range: 'medium', image: 'assets/hero/mage.png', unlocked: true },
      { id: 'assassin', name: 'æš—å½±åˆºå®¢', rarity: 'legendary', attack: 200, speed: 2.5, range: 'melee', image: 'assets/hero/assassin.png', unlocked: false }
    ];

    const SKILL_CARDS = [
      { id: 'berserk', name: 'ç‹‚æˆ°å£«', cost: 80, cd: 30, desc: 'è¿‘æˆ°è‹±é›„æ”»æ“Š+50%', rarity: 'common', image: 'assets/skill/berserk.png', unlocked: true },
      { id: 'freeze', name: 'å†°å°', cost: 120, cd: 45, desc: 'å‡çµæ•µäºº3ç§’', rarity: 'rare', image: 'assets/skill/freeze.png', unlocked: true },
      { id: 'meteor', name: 'éš•çŸ³', cost: 150, cd: 60, desc: '1000ç¯„åœå‚·å®³', rarity: 'epic', image: 'assets/skill/meteor.png', unlocked: true },
      { id: 'heal', name: 'æ²»ç™’', cost: 100, cd: 40, desc: 'åŸç‰†å›è¡€30%', rarity: 'rare', image: 'assets/skill/heal.png', unlocked: true },
      { id: 'slow', name: 'é²ç·©', cost: 70, cd: 25, desc: 'æ•µäººæ¸›é€Ÿ50%', rarity: 'common', image: 'assets/skill/slow.png', unlocked: true },
      { id: 'shield', name: 'è­·ç›¾', cost: 90, cd: 45, desc: 'ç”¢ç”Ÿ500å¸æ”¶ç›¾', rarity: 'common', image: 'assets/skill/shield.png', unlocked: true }
    ];

    // --- ç‹€æ…‹ç®¡ç† (ä¸å½±éŸ¿ LocalStorage) ---
    let state = {
      screen: 'prepare',
      balance: 0,
      selectedHero: HEROES[0],
      selectedCards: []
    };

    const rarityColors = { common: 'bg-gray-500', rare: 'bg-blue-500', epic: 'bg-purple-600', legendary: 'bg-yellow-500' };

    // --- åˆå§‹åŒ– ---
    function init() {
      state.balance = parseInt(localStorage.getItem('sicbo_balance')) || 5000;
      render();
    }

    // --- é€šç”¨å¤–æ®¼ (ç²¾ç°¡æ ¸å¿ƒï¼šæŠŠé‡è¤‡çš„å°èˆªèˆ‡èƒŒæ™¯å°è£) ---
    function screenWrapper(content) {
      return `
        <div class="h-full w-full bg-gradient-to-b from-slate-900 via-indigo-950 to-slate-900 text-white flex flex-col">
          <div class="p-4 flex justify-between items-center bg-black/20 backdrop-blur-md border-b border-white/10">
            <button onclick="location.href='index.html'" class="font-bold text-gray-400">HOME</button>
            <div class="bg-yellow-500/20 px-3 py-1 rounded-full border border-yellow-500/50 text-yellow-500 font-bold">
              ğŸ’ ${state.balance.toLocaleString()}
            </div>
          </div>
          <div class="flex-1 overflow-y-auto custom-scroll p-4">${content}</div>
          <div class="grid grid-cols-3 bg-black/40 backdrop-blur-md border-t border-white/10 p-2 pb-6">
            <button onclick="changeScreen('prepare')" class="text-center ${state.screen === 'prepare' ? 'text-purple-400' : 'text-gray-500'}">å‚™æˆ°</button>
            <button onclick="changeScreen('shop')" class="text-center ${state.screen === 'shop' ? 'text-purple-400' : 'text-gray-500'}">å•†åŸ</button>
            <button onclick="changeScreen('settings')" class="text-center ${state.screen === 'settings' ? 'text-purple-400' : 'text-gray-500'}">è¨­å®š</button>
          </div>
        </div>
      `;
    }

    // --- å„é é¢æ¸²æŸ“ ---
    function renderPrepare() {
      const hero = state.selectedHero;
      const canStart = hero && state.selectedCards.length === 5;
      return `
        <div class="max-w-md mx-auto space-y-6">
          <div class="bg-white/5 rounded-3xl p-6 border border-white/10 text-center">
            <h2 class="text-gray-400 text-sm mb-4">ç›®å‰å‡ºæˆ°</h2>
            <img src="${hero.image}" class="w-32 h-32 mx-auto rounded-2xl mb-4 border-2 border-purple-500 shadow-lg shadow-purple-500/20" onerror="this.src='https://via.placeholder.com/150?text=Hero'">
            <h1 class="text-2xl font-black">${hero.name}</h1>
            <button onclick="changeScreen('hero-select')" class="mt-6 w-full py-2 bg-white/10 rounded-xl text-sm">æ›´æ›è‹±é›„</button>
          </div>

          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="font-bold">æ”œå¸¶æŠ€èƒ½ (${state.selectedCards.length}/5)</span>
              <button onclick="changeScreen('card-select')" class="text-purple-400 text-sm">ç·¨è¼¯</button>
            </div>
            <div class="grid grid-cols-5 gap-2">
              ${[0,1,2,3,4].map(i => {
                const card = state.selectedCards[i];
                return card ? 
                  `<img src="${card.image}" class="aspect-square rounded-lg border border-purple-500" onerror="this.src='https://via.placeholder.com/80?text=Skill'">` :
                  `<div class="aspect-square bg-white/5 rounded-lg border border-dashed border-white/20 flex items-center justify-center text-gray-600">+</div>`;
              }).join('')}
            </div>
          </div>

          <button onclick="startBattle()" ${canStart ? '' : 'disabled'} 
            class="w-full py-4 rounded-2xl text-xl font-black transition-all ${canStart ? 'bg-gradient-to-r from-purple-600 to-indigo-600 shadow-xl shadow-purple-500/40 active:scale-95' : 'bg-gray-800 text-gray-500 cursor-not-allowed'}">
            ${canStart ? 'å‡ºå¾' : 'æŠ€èƒ½å°šæœªå¸¶é½Š'}
          </button>
        </div>
      `;
    }

    function renderHeroSelect() {
      return `
        <div class="grid grid-cols-2 gap-4">
          ${HEROES.map(h => `
            <div onclick="${h.unlocked ? `selectHero('${h.id}')` : ''}" class="bg-white/5 p-3 rounded-2xl border-2 ${state.selectedHero.id === h.id ? 'border-purple-500' : 'border-transparent'} ${!h.unlocked ? 'opacity-40' : ''}">
              <img src="${h.image}" class="w-full aspect-square object-cover rounded-xl mb-2">
              <div class="text-center font-bold">${h.name}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderCardSelect() {
      return `
        <div class="grid grid-cols-1 gap-3 pb-10">
          ${SKILL_CARDS.map(c => {
            const isSelected = state.selectedCards.some(sc => sc.id === c.id);
            return `
              <div onclick="toggleCard('${c.id}')" class="bg-white/5 p-3 rounded-2xl border-2 flex items-center gap-4 ${isSelected ? 'border-purple-500' : 'border-transparent'}">
                <img src="${c.image}" class="w-16 h-16 rounded-xl">
                <div class="flex-1">
                  <div class="font-bold">${c.name} <span class="text-[10px] ${rarityColors[c.rarity]} px-1 rounded ml-1 uppercase">${c.rarity}</span></div>
                  <div class="text-xs text-gray-400">${c.desc}</div>
                </div>
                <div class="text-yellow-500 text-sm font-bold">${c.cost}</div>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    // --- é‚è¼¯æ§åˆ¶ ---
    function render() {
      const app = document.getElementById('app');
      let body = '';
      if (state.screen === 'prepare') body = renderPrepare();
      else if (state.screen === 'hero-select') body = renderHeroSelect();
      else if (state.screen === 'card-select') body = renderCardSelect();
      else if (state.screen === 'shop') body = '<div class="text-center py-20 text-gray-500 italic">å•†åŸç±Œå‚™ä¸­...</div>';
      else if (state.screen === 'settings') body = '<div class="text-center py-20 text-gray-500 italic">è¨­å®šè¨­å®šä¸­...</div>';
      
      app.innerHTML = screenWrapper(body);
    }

    function changeScreen(s) { state.screen = s; render(); }
    
    function selectHero(id) { 
      state.selectedHero = HEROES.find(h => h.id === id); 
      state.screen = 'prepare'; 
      render(); 
    }

    function toggleCard(id) {
      const idx = state.selectedCards.findIndex(c => c.id === id);
      if (idx > -1) state.selectedCards.splice(idx, 1);
      else if (state.selectedCards.length < 5) state.selectedCards.push(SKILL_CARDS.find(c => c.id === id));
      render();
    }

    function startBattle() {
  if (state.selectedHero && state.selectedCards.length === 5) {
    // å­˜å„²ç›®å‰é¸ä¸­çš„è‹±é›„èˆ‡å¡çµ„
    localStorage.setItem('battle_hero', JSON.stringify(state.selectedHero));
    localStorage.setItem('battle_cards', JSON.stringify(state.selectedCards));
    
    // è·³è½‰åˆ°æˆ°é¬¥é é¢
    location.href = 'god_battle.html';
  } else {
    alert("è«‹é¸å¥½è‹±é›„ä¸¦å¸¶æ»¿5å¼µæŠ€èƒ½å¡ï¼");
  }
}

    init();
  </script>
</body>
</html>