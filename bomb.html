<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover" />
    <title>å°‹å¯¶å†’éšª</title>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --gold: #ffd86b;
            --red: #ff4757;
            --green: #2ecc71;
            --dark: #1a0505;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", Arial, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--dark);
            color: #fff;
            font-family: Arial;
            height: 100dvh;
            /* ç¢ºä¿ä½¿ç”¨å‹•æ…‹è¦–çª—é«˜åº¦ */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            touch-action: manipulation;
            /* ç§»é™¤åŸæœ¬é€™è£¡çš„ padding-bottomï¼Œæ”¹åˆ°é¢æ¿è£¡è™•ç† */
        }

        .bg-stars {
            position: fixed;
            /* æ”¹ç‚º fixed ç¢ºä¿æ²å‹•æ™‚ä¾ç„¶è¦†è“‹ */
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            /* æ·±è‰²æ¼¸å±¤ */
        }

        @keyframes bgMove {
            from {
                background-position: 0 0;
            }

            to {
                background-position: 1000px 1000px;
            }
        }

        .topbar {
            /* 1. èƒŒæ™¯é¡è‰²æœƒå¾æœ€é ‚éƒ¨é–‹å§‹å¡«æ»¿ */
            background: linear-gradient(#4a0404, #2a0202);

            /* 2. å¢åŠ ç¸½é«˜åº¦ï¼ŒåŸæœ¬æ˜¯ 50pxï¼Œæˆ‘å€‘æ”¹ç‚º 65px ç¢ºä¿ç©ºé–“å……è¶³ */
            height: calc(30px + env(safe-area-inset-top));

            /* 3. ä½¿ç”¨ padding-top é¿é–‹ç€æµ·ï¼Œä¸¦å¢åŠ ä¸€é»é¡å¤–çš„å®‰å…¨è·é›¢ (å¦‚ 10px) */
            padding-top: calc(env(safe-area-inset-top));

            display: flex;
            align-items: center;
            /* è®“å…§å®¹åœ¨å‰©é¤˜çš„ç©ºé–“å‚ç›´ç½®ä¸­ */
            justify-content: flex-start;
            gap: 6px;
            padding-left: 10px;
            padding-right: 10px;
            border-bottom: 2px solid #5c0a0a;
            z-index: 1000;
            box-sizing: border-box;
            width: 100%;
        }

        .sound-btn {
            font-size: 10px;
            background: #4a148c;
            border: 1px solid #ce93d8;
            padding: 3px 6px;
            border-radius: 12px;
            color: #fff;
        }

        .balance-box {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--gold);
            border-radius: 8px;
            padding: 4px 8px;
            color: var(--gold);
            font-weight: bold;
            font-size: 13px;
        }

        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* æ–°å¢ï¼šè®“å…§å®¹å‚ç›´ç½®ä¸­ï¼Œå¡«è£œä¸‹æ–¹ç©ºæ´ */
            padding: 10px;
            gap: 15px;
            /* ç¨å¾®åŠ å¤§é–“è·ï¼Œè®“æ‰‹æ©Ÿé»æ“Šæ›´èˆ’æœ */
            overflow-y: auto;
            z-index: 10;
            width: 100%;
            box-sizing: border-box;
        }

        .top-winner-bar {
            width: 92%;
            padding: 8px 12px;
            /* æ¸›å°‘é‚Šè·ï¼Œé¿å…æŠŠéŠæˆ²å€æ¨å¾—å¤ªé  */
            margin: 10px auto 15px auto;

            background: rgba(0, 0, 0, 0.3);
            /* æ·±è‰²èƒŒæ™¯æ›´èƒ½é¡¯å‡ºç¨±è™Ÿç‰¹æ•ˆ */
            border: 1px solid rgba(212, 175, 55, 0.5);
            /* é™ä½é‚Šæ¡†äº®åº¦ */
            border-radius: 50px;
            /* è®Šæˆåœ“è§’çš„è† å›Šç‹€æ›´ç²¾ç·» */
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);

            position: relative;
            z-index: 5;

            /* ç¢ºä¿å…§å®¹ç‰©åœ¨åŒä¸€è¡Œä¸”ä¸æ›è¡Œ */
            white-space: nowrap;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* å¦‚æœä½ æƒ³è®“è£¡é¢çš„åå­—æˆ–ç´€éŒ„å¤§ä¸€é»ï¼Œä¹Ÿå¯ä»¥å¾®èª¿ */
        #topWinnerName {
            display: flex;
            flex-direction: column;
            /* è®“ç¨±è™Ÿã€åå­—ã€é‡‘é¡å‚ç›´æ’é–‹ï¼Œæ›´ä½”ç©ºé–“ */
            gap: 8px;
            align-items: center;
        }

        .multiplier-step {
            font-size: 14px;
            color: #aaa;
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255, 216, 107, 0.3);
        }

        .multiplier-step.active {
            color: var(--gold);
            border-color: var(--gold);
            background: rgba(255, 216, 107, 0.2);
            font-weight: bold;
            box-shadow: 0 0 10px var(--gold);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 350px;
            aspect-ratio: 1/1;
            margin: 10px 0;
        }

        .tile {
            background: #3d0a0a;
            border-radius: 8px;
            border: 1px solid #5c0a0a;
            border-bottom: 5px solid #2a0505;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            /* æ–°å¢ä»¥ä¸‹ä¸‰è¡Œï¼Œç¢ºä¿æ ¼å­çµ•å°æ˜¯æ­£æ–¹å½¢ä¸”ä¸è®Šå½¢ */
            aspect-ratio: 1 / 1;
            width: 100%;
            box-sizing: border-box;
        }


        @keyframes gemAppear {
            0% {
                transform: scale(0) rotate(-45deg);
                opacity: 0;
            }

            80% {
                transform: scale(1.2) rotate(10deg);
            }

            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .tile.active {
            background: linear-gradient(145deg, #4a0a0a, #2a0505);
            border: 1.5px solid var(--gold);
            /* åŠ å…¥é‡‘é‚Š */
            box-shadow: inset 0 0 10px rgba(255, 216, 107, 0.2);
            /* åŠ å…¥å‘¼å¸ç‡ˆç‰¹æ•ˆï¼Œä¸€çœ¼çœ‹å‡ºé€™å€å¯ä»¥é» */
            animation: pulse-active 2s infinite alternate;
        }

        /* ç§»é™¤æˆ–è¦†è“‹åŸæœ¬æœƒå°è‡´ä½ç§»çš„ active ç¸®æ”¾ */
        .tile.active:active {
            transform: scale(0.95);
            /* æ”¹ç”¨ç­‰æ¯”ä¾‹å¾®ç¸®å°æ¨¡æ“¬æŒ‰å£“ï¼Œä¸æœƒå½±éŸ¿ä½ˆå±€ */
            border-bottom-width: 4px;
            /* ä¿æŒé‚Šæ¡†é«˜åº¦ä¸€è‡´é˜²æ­¢æŠ–å‹• */
        }

        .tile.revealed-coin {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5) !important;
            border: 1.5px solid #fff !important;
            border-bottom: 4px solid #2d5a9e !important;
            color: white;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            animation: flip 0.3s forwards;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: default;
            z-index: 2;
            /* ç¢ºä¿å±¤ç´šé«˜æ–¼ä¸€èˆ¬æ ¼å­ */
        }

        /* ç‚¸å½ˆæ ¼ï¼šä¿®æ­£é¡è‰²ä¸¦ç¢ºä¿ä¸è¢«è¦†è“‹ */
        .tile.revealed-bomb {
            background: linear-gradient(135deg, #ff4b2b, #ff416c) !important;
            border: 1.5px solid #fff !important;
            border-bottom: 4px solid #b22222 !important;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            animation: shake 0.4s ease-in-out;
            cursor: default;
            z-index: 2;
        }

        /* ä¿®æ­£ flip å‹•ç•«ï¼Œç¢ºä¿ transform ä¸æœƒæ®˜ç•™ç¸®æ”¾ä»¥å¤–çš„åç§» */
        @keyframes flip {
            from {
                transform: perspective(400px) rotateY(90deg);
                opacity: 0;
            }

            to {
                transform: perspective(400px) rotateY(0deg);
                opacity: 1;
            }
        }

        /* ä¿®æ­£ shake å‹•ç•«ï¼Œç¢ºä¿æœ€å¾Œå›åˆ°åŸä½ä¸”ä¸å½±éŸ¿å¯¬åº¦ */
        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-3px);
            }

            75% {
                transform: translateX(3px);
            }
        }

        /* å‘¼å¸ç‡ˆå‹•ç•«å®šç¾© */
        @keyframes pulse-active {
            from {
                box-shadow: inset 0 0 5px rgba(255, 216, 107, 0.1), 0 0 5px rgba(255, 216, 107, 0.1);
            }

            to {
                box-shadow: inset 0 0 15px rgba(255, 216, 107, 0.3), 0 0 12px rgba(255, 216, 107, 0.4);
            }
        }

        .tile.disabled {
            cursor: default;
            opacity: 0.5;
            filter: grayscale(1);
            border-color: #333;
            border-bottom: 2px solid #111;
            animation: none;
        }

        .controls {
            width: 100%;
            max-width: 350px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid #4a0404;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-row {
            display: flex;
            justify-content: space-between;
            /* è®“æ–‡å­—èˆ‡é¸æ“‡å™¨åˆ†é–‹åˆ°å…©ç«¯ */
            align-items: center;
            gap: 20px;
            width: 100%;
            /* å¼·åˆ¶å¡«æ»¿å®¹å™¨å¯¬åº¦ */
            padding: 5px 0;
        }

        .input-row span {
            color: #ccc;
            font-weight: bold;
            flex: 1;
            /* è®“æ–‡å­—ä½”æ“šå‰©é¤˜ç©ºé–“ï¼Œæ¨å‹•å³å´å°é½Š */
            text-align: left;
        }

        .bet-selector {
            /* ä¿æŒå›ºå®šå¯¬åº¦ 150px ç¢ºä¿ä¸Šä¸‹å…©è¡Œå°é½Š */
            width: 150px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #5c0a0a;
            border-radius: 10px;
            padding: 2px;
        }

        .action-btn {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-start {
            background: var(--gold);
            color: #000;
            box-shadow: 0 5px 0 #b38b00;
        }

        .btn-cashout {
            background: var(--green);
            color: #fff;
            box-shadow: 0 5px 0 #27ae60;
            display: none;
        }

        #rankSidebar {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100%;
            background: rgba(20, 0, 0, 0.95);
            border-left: 2px solid var(--gold);
            z-index: 2000;
            transition: 0.3s;
            padding: 20px;
            overflow-y: auto;
        }

        #rankOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 1999;
        }

        .rank-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 216, 107, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-title {
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 3px;
            margin-right: 4px;
        }

        .t-red {
            border: 1px solid #ff4757;
            color: #ff4757;
        }

        .t-orange {
            border: 1px solid #ffa502;
            color: #ffa502;
        }

        .t-purple {
            border: 1px solid #a4b0be;
            color: #a4b0be;
        }

        @keyframes flip {
            from {
                transform: perspective(400px) rotateY(90deg);
                opacity: 0;
            }

            to {
                transform: perspective(400px) rotateY(0deg);
                opacity: 1;
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-2px);
            }

            /* ç¸®å°æŠ–å‹•å¹…åº¦æ¸›å°‘å°ä½ˆå±€çš„å½±éŸ¿ */
            75% {
                transform: translateX(2px);
            }
        }

        .bet-btn {
            background: #3d0a0a;
            border: 1px solid var(--gold);
            color: var(--gold);
            width: 30px;
            height: 30px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }

        .bet-btn:disabled {
            opacity: 0.3;
        }

        .bet-display {
            flex: 1;
            text-align: center;
            font-weight: bold;
            color: var(--gold);
            font-size: 16px;
        }

        .win-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: var(--gold);
            padding: 20px 40px;
            border: 2px solid var(--gold);
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            z-index: 10000;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            animation: toastFade 2.5s forwards;
            pointer-events: none;
        }

        @keyframes toastFade {
            0% {
                opacity: 0;
                transform: translate(-50%, -40%);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, -50%);
            }

            80% {
                opacity: 1;
                transform: translate(-50%, -50%);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
        }

        /* å¤§ççµç®—ç•«é¢ */
        .big-win-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            animation: fadeIn 0.5s forwards;
        }

        .big-win-content {
            text-align: center;
            animation: scorePopup 0.6s cubic-bezier(0.17, 0.89, 0.32, 1.49);
        }

        .big-win-title {
            font-size: 40px;
            color: #ff0000;
            text-shadow: 0 0 20px #ff0000, 0 0 40px #ff8c00;
            font-weight: 900;
            margin-bottom: 10px;
            letter-spacing: 5px;
        }

        .big-win-amount {
            font-size: 48px;
            color: var(--gold);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
            font-weight: bold;
            margin: 20px 0;
        }

        .big-win-mult {
            font-size: 24px;
            color: #fff;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 20px;
            border-radius: 20px;
        }

        @keyframes scorePopup {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* æ™®é€šä¸­çæç¤º (å°æç¤ºæ¡†) */
        .win-result-toast {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid #444;
            padding: 15px 30px;
            border-radius: 12px;
            text-align: center;
            z-index: 10002;
            pointer-events: none;
            animation: simpleFade 2s forwards;
        }

        .win-result-toast .amount {
            color: var(--gold);
            font-size: 24px;
            font-weight: bold;
        }

        .win-result-toast .mult {
            color: #888;
            font-size: 14px;
        }

        @keyframes simpleFade {
            0% {
                opacity: 0;
                transform: translate(-50%, -30%);
            }

            15% {
                opacity: 1;
                transform: translate(-50%, -50%);
            }

            85% {
                opacity: 1;
                transform: translate(-50%, -50%);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
        }

        .player-title {
            font-weight: 900;
            margin-right: 5px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* ç¨±è™Ÿç­‰ç´šè‰²å½© */
        .t-green {
            color: #2ecc71 !important;
        }

        .t-blue {
            color: #3498db !important;
        }

        .t-purple {
            color: #9b59b6 !important;
        }

        .t-orange {
            color: #e67e22 !important;
        }

        .t-red {
            color: #ff4757 !important;
            animation: title-glow 1s infinite alternate;
        }

        @keyframes title-glow {
            from {
                filter: drop-shadow(0 0 1px #ff4757);
            }

            to {
                filter: drop-shadow(0 0 5px #ff4757);
            }
        }

        /* --- 2. æ’è¡Œæ¦œé …ç›®ç‰¹æ•ˆæ ¸å¿ƒ (ç¢ºä¿åœ¨éŠæˆ² Sidebar å…§ç”Ÿæ•ˆ) --- */
        .rank-item {
            position: relative !important;
            overflow: hidden !important;
            contain: paint;
            /* é˜²æ­¢ç‰¹æ•ˆæº¢å‡ºé€ æˆæ‰‹æ©Ÿæ©«å‘æ»¾å‹• */
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* [ç‰¹æ•ˆï¼šæ¥µé™ç„ç«] */
        .fx-fire {
            border: 2px solid transparent !important;
            background: linear-gradient(#2a0000, #2a0000) padding-box,
                linear-gradient(0deg, #ff4757, #ff9f43, #ff4757) border-box !important;
            background-size: 100% 100%, 100% 300% !important;
            color: #fff !important;
            box-shadow: inset 0 0 15px #741b1b, 0 0 15px rgba(255, 71, 87, 0.5) !important;
            text-shadow: 0 0 8px #ff4757 !important;
            animation: fire-flicker 0.2s ease-in-out infinite alternate, border-flow 1.5s linear infinite !important;
        }

        .fx-fire::before {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200%;
            background: linear-gradient(0deg, transparent 0%, rgba(255, 69, 0, 0.4) 20%, transparent 80%);
            z-index: -1;
            animation: fire-rise 1s linear infinite;
        }

        /* [ç‰¹æ•ˆï¼šé›·éœ†éœ“è™¹] */
        .fx-neon {
            border: 2px solid #fff !important;
            background: rgba(0, 0, 0, 0.9) !important;
            box-shadow: 0 0 10px #fff, 0 0 20px #00d2ff !important;
            animation: neon-flicker 2s infinite, neon-rainbow 4s linear infinite !important;
        }

        /* [ç‰¹æ•ˆï¼šè‡³å°Šçš‡é‡‘] */
        .fx-gold {
            border: 1px solid #ffd700 !important;
            background-image: linear-gradient(110deg, #6b5500 0%, #ffd700 50%, #6b5500 100%) !important;
            background-size: 200% auto !important;
            animation: shine-gold 3s linear infinite !important;
        }

        /* [ç‰¹æ•ˆï¼šçµ•å°é›¶åº¦] */
        .fx-ice {
            border: 1px solid #00f2fe !important;
            background: linear-gradient(135deg, #005f73, #00d4ff) !important;
            text-shadow: 0 0 10px #7ed6ff !important;
            animation: ice-shimmer 2s ease-in-out infinite alternate !important;
        }

        /* [ç‰¹æ•ˆï¼šé»‘æ´æ¹®æ»…] */
        .fx-void {
            border: 2px solid #2f3542 !important;
            background: black !important;
            color: #a55eea !important;
            box-shadow: 0 0 20px #6c5ce7 !important;
            animation: void-pulse 3s ease-in-out infinite !important;
        }

        /* --- ç‰¹æ•ˆï¼šæ·±æµ·é›·é³´ (ä¿®æ­£ç‰ˆ) --- */
        .fx-thunder {
            border: 1px solid #4834d4 !important;
            background: #060b28 !important;
            color: #fff !important;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .fx-thunder::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            z-index: -1;
            animation: lightning-strike 2s steps(1) infinite;
        }

        @keyframes lightning-strike {

            0%,
            95%,
            98% {
                opacity: 0;
            }

            96%,
            99% {
                opacity: 0.4;
            }

            /* æ¨¡æ“¬é–ƒé›»ç¬é–“äº®èµ· */
        }

        /* --- 3. æ‰€æœ‰é—œéµå‹•ç•«å®šç¾© (åˆä½µé¦–é æ‰€æœ‰ Keyframes) --- */
        @keyframes border-flow {
            0% {
                background-position: 0% 0%, 50% 100%;
            }

            100% {
                background-position: 0% 0%, 50% -100%;
            }
        }

        @keyframes fire-rise {
            0% {
                transform: translateY(0%);
                opacity: 0.8;
            }

            100% {
                transform: translateY(-50%);
                opacity: 0.4;
            }
        }

        @keyframes fire-flicker {
            0% {
                filter: brightness(1);
            }

            100% {
                filter: brightness(1.3);
            }
        }

        @keyframes neon-rainbow {
            0% {
                filter: hue-rotate(0deg);
            }

            100% {
                filter: hue-rotate(360deg);
            }
        }

        @keyframes neon-flicker {

            0%,
            18%,
            22%,
            25%,
            53%,
            57%,
            100% {
                opacity: 1;
            }

            20%,
            24%,
            55% {
                opacity: 0.7;
            }
        }

        @keyframes shine-gold {
            to {
                background-position: 200% center;
            }
        }

        @keyframes ice-shimmer {
            from {
                filter: brightness(1);
                box-shadow: 0 0 5px #00f2fe;
            }

            to {
                filter: brightness(1.2);
                box-shadow: 0 0 20px #00f2fe;
            }
        }

        @keyframes void-pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(0.98);
            }
        }
    </style>
</head>

<body onclick="handleFirstClick()">

    <div class="bg-stars"></div>

    <div id="rankOverlay" onclick="toggleRank()"></div>
    <div id="rankSidebar">
        <h3 style="color:var(--gold); margin-bottom:20px; text-align:center;">ğŸ†å°‹å¯¶æ’è¡Œæ¦œ</h3>
        <div id="mineRankList"></div>
    </div>

    <div class="topbar">
        <div class="sound-btn" onclick="toggleMute()" id="muteBtn">ğŸ”Š</div>
        <div class="sound-btn" onclick="cycleBGM()" id="bgmBtn">ğŸµ éŸ³æ¨‚ 1</div>
        <div class="balance-box">ğŸ’ <span id="balanceText">0</span></div>
        <div style="flex:1"></div>
        <button onclick="toggleRank()"
            style="background:none; border:1px solid var(--gold); color:var(--gold); padding:5px 10px; border-radius:5px; font-size:12px;">ğŸ†
            æ’è¡Œæ¦œ</button>
        <a href="index.html" style="text-decoration:none;">
            <button
                style="background:none; border:1px solid #777; color:#ccc; border-radius:5px; padding:5px 12px; font-size:14px; font-weight:bold;">ğŸ 
                å›å¤§å»³</button>
        </a>
    </div>
    <div class="main-container">
        <div class="top-winner-bar" id="topWinnerName">è¼‰å…¥ä¸­...</div>
        <div class="multiplier-step" id="multDisplay">ä¸‹ä¸€æ ¼å€ç‡: --</div>
        <div class="grid-container" id="grid"></div>

        <div class="controls">
            <div class="input-row">
                <span>ğŸ’ ä¸‹æ³¨é‡‘é¡:</span>
                <div class="bet-selector">
                    <button class="bet-btn" onclick="changeBet(-1)" id="betMinus">-</button>
                    <div class="bet-display" id="betText">10,000,000</div>
                    <button class="bet-btn" onclick="changeBet(1)" id="betPlus">+</button>
                </div>
            </div>
            <div class="input-row">
                <span>ğŸ’£ ç‚¸å½ˆæ•¸é‡(å½±éŸ¿æ¢éšªå€ç‡)</span>
                <div class="bet-selector">
                    <button class="bet-btn" onclick="changeBomb(-1)" id="bombMinus">-</button>
                    <div class="bet-display" id="bombText">10</div>
                    <button class="bet-btn" onclick="changeBomb(1)" id="bombPlus">+</button>
                </div>
            </div>

            <button class="action-btn btn-start" id="startBtn" onclick="startGame()">é–‹å§‹æ¢éšª</button>
            <button class="action-btn btn-cashout" id="cashoutBtn" onclick="cashout()">è´å¾—: $0</button>
        </div>
    </div>

    <audio id="sndCoin" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
    <audio id="sndBomb" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" preload="auto"></audio>
    <audio id="bgm1" src="background-music-434612.mp3" loop preload="auto"></audio>
    <audio id="bgm2" src="another-bgm.mp3" loop preload="auto"></audio>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore-compat.js"></script>
    <script>
        // --- Firebase åˆå§‹åŒ– ---
        const _k = ["AIzaSyDSRfVA", "uWCWCUd1NJop", "J6wHvsqsAM4UzJA"];
        const firebaseConfig = {
            apiKey: _k.join(''),
            authDomain: "game-80d68.firebaseapp.com",
            projectId: "game-80d68",
            storageBucket: "game-80d68.firebasestorage.app",
            messagingSenderId: "636332967920",
            appId: "1:636332967920:web:29e5600daf4db0ab613f35"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- æ ¸å¿ƒè®Šæ•¸ ---
        let balance = parseFloat(localStorage.getItem('sicbo_balance')) || 5000;
        let lastSyncedBalance = balance;
        let isGameActive = false;
        let mines = [];
        let revealedCount = 0;
        let currentBet = 0;
        let isMuted = false, currentBGM = 1, hasInteracted = false;
        const betOptions = [10000, 50000, 100000, 1000000, 5000000, 10000000];
        let currentBetIdx = 5;
        // å®šç¾©ç‚¸å½ˆæ•¸é‡çš„é¸é …ï¼ˆä¾ç…§åŸæœ¬ select çš„å€¼ï¼‰
        const bombOptions = [3, 5, 10, 15, 20];
        let currentBombIndex = 2; // é è¨­ 3 é¡†

        function changeBomb(delta) {
            // éŠæˆ²é€²è¡Œä¸­ç¦æ­¢ä¿®æ”¹
            if (typeof isGameActive !== 'undefined' && isGameActive) return;

            currentBombIndex += delta;

            // é™åˆ¶ç¯„åœ
            if (currentBombIndex < 0) currentBombIndex = 0;
            if (currentBombIndex >= bombOptions.length) currentBombIndex = bombOptions.length - 1;

            const count = bombOptions[currentBombIndex];
            document.getElementById('bombText').innerText = count;

            // æ›´æ–°å€ç‡é¡¯ç¤ºï¼ˆå¦‚æœæœ‰é€™åŠŸèƒ½ï¼‰
            if (typeof updateNextWinInfo === 'function') {
                updateNextWinInfo();
            }
        }

        // ä¿®æ­£åŸæœ¬ startGame æŠ“å–ç‚¸å½ˆå€¼çš„æ–¹å¼
        // è«‹åœ¨åŸæœ¬çš„ startGame å‡½æ•¸ä¸­ï¼Œå°‡æŠ“å– bombCount çš„åœ°æ–¹æ”¹ç‚ºï¼š
        // const bombCount = parseInt(document.getElementById('bombText').innerText);
        function updateUI() {
            const balanceEl = document.getElementById('balanceText');
            if (balanceEl) {
                balanceEl.textContent = Math.floor(balance).toLocaleString();
            }
            // ç¢ºä¿ Key å€¼èˆ‡æ‚¨å…¶ä»–éŠæˆ²ä¸€è‡´
            localStorage.setItem('sicbo_balance', balance);
        }

        // --- éŸ³æ¨‚é‚è¼¯ (æ¯”ç…§éº»å°‡) ---
        function handleFirstClick() { if (!hasInteracted) { hasInteracted = true; playBGM(); } }
        function playBGM() {
            const b1 = document.getElementById('bgm1'), b2 = document.getElementById('bgm2');
            [b1, b2].forEach(b => { if (b) b.pause(); });
            if (isMuted) return;
            const track = (currentBGM === 1 ? b1 : b2);
            if (track) track.play().catch(() => { });
        }
        function cycleBGM() {
            currentBGM = currentBGM === 1 ? 2 : 1;
            document.getElementById('bgmBtn').textContent = `ğŸµ éŸ³æ¨‚ ${currentBGM}`;
            if (hasInteracted) playBGM();
        }
        function toggleMute() {
            isMuted = !isMuted;
            document.getElementById('muteBtn').textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
            playBGM();
        }

        async function syncToFirebase() {
            const playerId = localStorage.getItem('player_id');
            if (!playerId || balance === lastSyncedBalance) return;
            try {
                await db.collection("users").doc(playerId).update({
                    balance: balance,
                    lastUpdate: firebase.firestore.Timestamp.now()
                });
                lastSyncedBalance = balance;
            } catch (e) { console.error("åŒæ­¥å¤±æ•—", e); }
        }

        function listenRank() {
            const rankList = document.getElementById('mineRankList');
            const topBar = document.getElementById('topWinnerName');

            if (!rankList || !topBar) return;

            db.collection("users")
                .orderBy("mineMaxWin", "desc")
                .limit(10)
                .onSnapshot(snap => {
                    let html = '';
                    let i = 1;

                    if (snap.empty) {
                        topBar.innerHTML = "ğŸ† æš«ç„¡æœ€é«˜ç´€éŒ„";
                        rankList.innerHTML = '<p style="text-align:center; color:#888;">å°šç„¡æ•¸æ“š</p>';
                        return;
                    }

                    snap.forEach(doc => {
                        const data = doc.data();
                        const win = data.mineMaxWin || 0;
                        if (win <= 0) return;

                        const fxClass = data.equipped_fx || "";
                        const titleText = data.equipped_title || "";
                        let titleColorClass = "t-blue";
                        if (titleText.includes("å¹¸é‹éŒ¦é¯‰")) titleColorClass = "t-koi-color";
                        else if (titleText.includes("è³­ç¥") || titleText.includes("å¯Œå¯æ•µåœ‹")) titleColorClass = "t-red";
                        const titleHTML = titleText ? `<span class="player-title ${titleColorClass}">ã€${titleText}ã€‘</span>` : "";

                        html += `
                    <div class="rank-item ${fxClass}">
                        <div class="rank-info">
                            <span class="rank-num">${i === 1 ? 'ğŸ†' : i}</span>
                            <span class="rank-name">${titleHTML}${data.name || 'ç„¡åæ°'}</span>
                        </div>
                        <span class="rank-bal" style="color:var(--gold)">ğŸ’${Math.floor(win).toLocaleString()}</span>
                    </div>`;

                        if (i === 1) {
                            topBar.innerHTML = `
                                <div class="${fxClass}" style="display:inline-block; font-size: 14px; padding: 2px 10px;">
                                    ğŸ† æœ€é«˜ç´€éŒ„ï¼š${titleHTML}<span style="color:#fff">${data.name || 'ç„¡åæ°'}</span> 
                                    <span style="color:var(--gold); margin-left:5px;">è´å¾— $${Math.floor(win).toLocaleString()}</span>
                                </div>`;
                        }
                        i++;
                    });
                    rankList.innerHTML = html;
                }, err => {
                    console.error("æ’è¡Œæ¦œç›£è½éŒ¯èª¤:", err);
                    topBar.innerHTML = "ğŸ† æƒé›·å¤§æŒ‘æˆ°"; // å ±éŒ¯æ™‚çµ¦äºˆé è¨­æ–‡å­—ï¼Œä¸é¡¯ç¤ºè¼‰å…¥ä¸­
                });
        }

        function toggleRank() {
            const s = document.getElementById('rankSidebar'), o = document.getElementById('rankOverlay');
            if (s.style.right === '0px') { s.style.right = '-300px'; o.style.display = 'none'; }
            else { s.style.right = '0px'; o.style.display = 'block'; }
        }

        function getMultiplier(totalMines, revealed) {
            if (revealed === 0) return 1;
            const totalTiles = 25;
            let multiplier = 1;

            // 1. åŸºç¤æ©Ÿç‡è¨ˆç®—
            for (let i = 0; i < revealed; i++) {
                multiplier *= (totalTiles - i) / (totalTiles - totalMines - i);
            }

            // 2. åŸºç¤æŠ½æ°´ç¶­æŒ 0.75
            let finalMult = multiplier * 0.75;

            // 3. å¼·åŒ–ç¸®æ¸›é‚è¼¯ï¼šæå‰è‡³è¶…é 40 å€å¾Œï¼Œå¢é•·é€Ÿåº¦å³è®Šç‚º 2%
            if (finalMult > 40) {
                let excess = finalMult - 40;
                finalMult = 40 + (excess * 0.02);
            }

            return finalMult;
        }

        function updateNextWinInfo() {
            // å°‡åŸæœ¬çš„ bombCount æ”¹ç‚º bombTextï¼Œä¸¦ç”¨ innerText å–å€¼
            const bombCountEl = document.getElementById('bombText');
            const bombCount = bombCountEl ? parseInt(bombCountEl.innerText) : 3;

            const nextMult = getMultiplier(bombCount, revealedCount + 1);
            const infoEl = document.getElementById('multDisplay');
            if (infoEl) {
                infoEl.textContent = `ä¸‹ä¸€æ ¼å€ç‡: x${nextMult.toFixed(2)}`;
                infoEl.classList.add('active');
                setTimeout(() => infoEl.classList.remove('active'), 200);
            }
        }
        function changeBet(dir) {
            if (isGameActive) return; // éŠæˆ²ä¸­ä¸èƒ½æ›ç±Œç¢¼
            currentBetIdx = Math.max(0, Math.min(betOptions.length - 1, currentBetIdx + dir));
            document.getElementById('betText').textContent = betOptions[currentBetIdx].toLocaleString();
        }
        function startGame() {
            const bet = betOptions[currentBetIdx];
            if (bet > balance) { alert("é¤˜é¡ä¸è¶³ï¼"); return; }

            // æ‰£æ¬¾èˆ‡åˆå§‹åŒ–
            balance -= bet;
            currentBet = bet;
            updateUI();
            syncToFirebase();

            isGameActive = true;
            revealedCount = 0;
            mines = new Array(25).fill(false);

            // è®€å–æ–°çš„ç‚¸å½ˆé¡¯ç¤ºæ–‡å­—
            let count = 0;
            const targetMines = parseInt(document.getElementById('bombText').innerText);

            // ä½ˆé›·é‚è¼¯
            while (count < targetMines) {
                let r = Math.floor(Math.random() * 25);
                if (!mines[r]) { mines[r] = true; count++; }
            }

            // æŒ‰éˆ•ç‹€æ…‹åˆ‡æ›
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('cashoutBtn').style.display = 'block';
            document.getElementById('cashoutBtn').disabled = true;

            // ç¦ç”¨æ‰€æœ‰èª¿æ•´é¸é … (åŒ…å«ç±Œç¢¼èˆ‡ç‚¸å½ˆ)
            document.getElementById('betMinus').disabled = true;
            document.getElementById('betPlus').disabled = true;
            document.getElementById('bombMinus').disabled = true; // æ–°å¢ï¼šç¦ç”¨ç‚¸å½ˆæ¸›è™Ÿ
            document.getElementById('bombPlus').disabled = true;  // æ–°å¢ï¼šç¦ç”¨ç‚¸å½ˆåŠ è™Ÿ

            updateNextWinInfo();
            renderGrid();
        }

        function renderGrid() {
            const grid = document.getElementById('grid'); grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const t = document.createElement('div'); t.className = 'tile active';
                t.onclick = () => revealTile(i, t); grid.appendChild(t);
            }
        }

        function revealTile(idx, el) {
            if (!isGameActive || el.classList.contains('disabled')) return;

            const currentBombs = parseInt(document.getElementById('bombText').innerText); // ä¿®æ­£é€™è£¡

            if (mines[idx]) {
                gameOver(false);
            } else {
                revealedCount++;
                el.classList.add('revealed-coin', 'disabled');
                el.innerHTML = 'ğŸ’';

                if (!isMuted) document.getElementById('sndCoin').play().catch(() => { });

                document.getElementById('cashoutBtn').disabled = false;

                const m = getMultiplier(currentBombs, revealedCount); // ä¿®æ­£é€™è£¡
                document.getElementById('cashoutBtn').textContent = `ææ¡¶è·‘è·¯: ğŸ’${Math.floor(currentBet * m).toLocaleString()}`;

                updateNextWinInfo();

                const totalSafeTiles = 25 - currentBombs; // ä¿®æ­£é€™è£¡
                if (revealedCount === totalSafeTiles) {
                    showWinToast(`ğŸ‰ å®Œç¾çš„æ¢éšªï¼å…¨é–‹çé‡‘ x${m.toFixed(2)}`);
                    setTimeout(() => { cashout(); }, 1500);
                }
            }
        }

        // è¼”åŠ©å‡½æ•¸ï¼šé¡¯ç¤ºæç¤º
        function showWinToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'win-toast';
            toast.innerHTML = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        async function cashout() {
            if (!isGameActive) return;

            const bombCount = parseInt(document.getElementById('bombText').innerText); // ä¿®æ­£é€™è£¡
            const m = getMultiplier(bombCount, revealedCount);
            const win = Math.floor(currentBet * m);

            // --- æ ¹æ“šå€ç‡æ±ºå®šé¡¯ç¤ºå“ªç¨®çµç®—ç•«é¢ ---
            if (m >= 40) {
                showBigWinUI(win, m); // å‘¼å«ä¹‹å‰å¯«çš„è±ªè¯ç‰ˆ (å…¨è¢å¹•/æ‰‹å‹•é—œé–‰)
            } else {
                showSimpleWinUI(win, m); // å‘¼å«æ™®é€šç‰ˆ (å°æ¡†/è‡ªå‹•æ¶ˆå¤±)
            }

            balance += win;
            // ... (é€™è£¡ä¿ç•™ä½ åŸæœ¬çš„ Firebase åŒæ­¥èˆ‡ localStorage æ›´æ–°é‚è¼¯ï¼Œä¸è¦æ”¹å‹•)

            // åŸ·è¡ŒåŒæ­¥
            const playerId = localStorage.getItem('player_id');
            if (playerId && db) {
                try {
                    const userRef = db.collection("users").doc(playerId);
                    const doc = await userRef.get();
                    let updateData = { balance: balance, lastUpdate: firebase.firestore.Timestamp.now() };
                    if (doc.exists) {
                        let currentMax = doc.data().mineMaxWin || 0;
                        if (win > currentMax) {
                            updateData.mineMaxWin = win;
                            updateData.mineMaxTime = firebase.firestore.FieldValue.serverTimestamp();
                        }
                    }
                    await userRef.update(updateData);
                    lastSyncedBalance = balance;
                } catch (e) { }
            }

            gameOver(true);
        }

        // è¼”åŠ©å‡½æ•¸ï¼šæ™®é€šè´éŒ¢æç¤º (è‡ªå‹•æ¶ˆå¤±)
        function showSimpleWinUI(amount, mult) {
            const toast = document.createElement('div');
            toast.className = 'win-result-toast';
            toast.innerHTML = `
        <div style="color:#ccc; font-size:14px; margin-bottom:5px;">æˆåŠŸæ’¤é€€</div>
        <div class="amount">ğŸ’ ${amount.toLocaleString()}</div>
        <div class="mult">ç²åˆ©å€ç‡ x${mult.toFixed(2)}</div>
    `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000); // 2ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
        }

        // è¼”åŠ©å‡½æ•¸ï¼šé¡¯ç¤ºå¤§ç UI
        function showBigWinUI(amount, mult) {
            const overlay = document.createElement('div');
            overlay.className = 'big-win-overlay';
            overlay.innerHTML = `
        <div class="big-win-content">
            <div class="big-win-title">ğŸ”¥ BIG WIN ğŸ”¥</div>
            <div class="big-win-amount">ğŸ’ ${amount.toLocaleString()}</div>
            <div class="big-win-mult">é”æˆå€ç‡ x${mult.toFixed(2)}</div>
            <p style="color: #aaa; margin-top: 30px;">é»æ“Šä»»ä½•è™•ç¹¼çºŒ</p>
        </div>
    `;

            // é»æ“Šå¾Œé—œé–‰å¤§çç•«é¢
            overlay.onclick = () => {
                overlay.style.opacity = '0';
                setTimeout(() => overlay.remove(), 300);
            };

            document.body.appendChild(overlay);

            // å¦‚æœæ²’éœéŸ³ï¼Œæ’­æ”¾ä¸€å€‹éœ‡æ’¼çš„éŸ³æ•ˆ
            if (!isMuted) {
                // é€™è£¡å¯ä»¥ä½¿ç”¨ä½ ç¾æœ‰çš„ sndCoinï¼Œæˆ–è€…å¦å¤–æ‰¾å€‹å¤§çéŸ³æ•ˆ
                document.getElementById('sndCoin').play().catch(() => { });
            }
        }
        // è¼”åŠ©å‡½æ•¸ï¼šé¡¯ç¤ºè¼¸çƒæç¤º (è‡ªå‹•æ¶ˆå¤±)
        function showLoseUI(betAmount) {
            const overlay = document.createElement('div');
            overlay.className = 'big-win-overlay'; // æ²¿ç”¨å¤§ççš„èƒŒæ™¯é®ç½©æ¨£å¼
            overlay.style.background = 'rgba(40, 0, 0, 0.85)'; // æ”¹æˆåç´…çš„æš—è‰²
            overlay.innerHTML = `
        <div class="big-win-content" style="animation: shake 0.5s ease-in-out;">
            <div class="big-win-title" style="color: #ff4757; text-shadow: 0 0 20px #ff0000;">ğŸ’¥ è¸©åˆ°ç‚¸å½ˆ ğŸ’¥</div>
            <div class="big-win-amount" style="color: #fff; font-size: 32px;">æå¤± ğŸ’ ${betAmount.toLocaleString()}</div>
            <p style="color: #aaa; margin-top: 20px;">å¥½é‹åœ¨ä¸‹ä¸€å±€ç­‰è‘—ä½ ...</p>
        </div>
    `;
            document.body.appendChild(overlay);

            // 2ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(() => {
                overlay.style.opacity = '0';
                overlay.style.transition = '0.5s';
                setTimeout(() => overlay.remove(), 500);
            }, 1000);
        }
        function gameOver(isWin) {
            isGameActive = false;

            // 1. å…ˆæŠ“å–ç•¶å‰ç‹€æ…‹
            const lastBet = currentBet;
            const currentBombs = parseInt(document.getElementById('bombText').innerText);

            // 2. ç¿»é–‹æ‰€æœ‰æ ¼å­
            document.querySelectorAll('.tile').forEach((t, i) => {
                t.classList.add('disabled');
                if (mines[i]) {
                    t.innerHTML = 'ğŸ’£';
                    t.classList.add('revealed-bomb');
                }
            });

            // 3. è™•ç†è¼¸è´åˆ†æ”¯
            if (!isWin) {
                if (!isMuted) document.getElementById('sndBomb').play().catch(() => { });
                setTimeout(() => {
                    showLoseUI(lastBet);
                }, 500);
            }

            // 4. é‡ç½® UI èˆ‡æŒ‰éˆ•
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('cashoutBtn').style.display = 'none';
            document.getElementById('betMinus').disabled = false;
            document.getElementById('betPlus').disabled = false;
            document.getElementById('bombMinus').disabled = false;
            document.getElementById('bombPlus').disabled = false;

            // 5. æ›´æ–°æ•¸æ“šèˆ‡åŒæ­¥ (æœ€å¾Œå†æ­¸é›¶)
            updateUI();
            syncToFirebase();
            updateNextWinInfo();
            revealedCount = 0; // æ”¾åœ¨æœ€å¾Œï¼Œç¢ºä¿ä¹‹å‰çš„ UI æ›´æ–°èƒ½æŠ“åˆ°æ­£ç¢ºçš„æ•¸å€¼
        }



        window.onload = async () => {
            // 1. ç¬¬ä¸€æ™‚é–“è®€å–æœ¬åœ°ï¼Œè®“ç©å®¶é€²å ´ç«‹åˆ»çœ‹åˆ°éŒ¢ï¼Œä¸å¡é “
            const savedBal = localStorage.getItem('sicbo_balance');
            if (savedBal !== null) {
                balance = parseFloat(savedBal);
            }

            // å…ˆé¡¯ç¤ºæœ¬åœ°è³‡æ–™ï¼Œç¢ºä¿ç•«é¢ä¸ç•™ç™½
            updateUI();
            renderGrid();
            updateNextWinInfo();

            // 2. æ ¸å¿ƒï¼šè¯ç¶²æ ¡æ­£ (è§£æ±ºæ»‘æ‰éŠæˆ²/æ›æ©Ÿå„²å€¼å•é¡Œ)
            const playerId = localStorage.getItem('player_id');
            if (playerId && typeof db !== 'undefined') {
                try {
                    const doc = await db.collection("users").doc(playerId).get();
                    if (doc.exists) {
                        const cloudBal = doc.data().balance;

                        // å¦‚æœé›²ç«¯çš„éŒ¢æ¯”è¼ƒå¤š (ä»£è¡¨åœ¨åˆ¥å°æ‰‹æ©Ÿç©é)ï¼Œæ‰æ›´æ–°æœ¬åœ°
                        if (cloudBal !== undefined && cloudBal > balance) {
                            balance = cloudBal;
                            localStorage.setItem('sicbo_balance', balance);
                            updateUI(); // å†æ¬¡æ›´æ–° UI é¡¯ç¤ºæ­£ç¢ºé‡‘é¡
                            console.log("å·²å¾é›²ç«¯åŒæ­¥æœ€æ–°é«˜é¡é¤˜é¡");
                        }
                        // å¦‚æœæœ¬åœ°éŒ¢æ¯”è¼ƒå¤š (ä»£è¡¨ä¸Šæ¬¡æ»‘æ‰æ²’åŒæ­¥æˆåŠŸ)ï¼Œä¸»å‹•å¹«é›²ç«¯è£œå‚³
                        else if (cloudBal !== undefined && balance > cloudBal) {
                            syncToFirebase();
                            console.log("æœ¬åœ°é€²åº¦é ˜å…ˆï¼Œå·²è‡ªå‹•è£œå‚³é›²ç«¯");
                        }
                    }
                } catch (e) {
                    console.log("é›¢ç·šæ¨¡å¼ï¼Œä½¿ç”¨æœ¬åœ°é¤˜é¡", e);
                }
            }

            // 3. æœ€å¾ŒåŠ è¼‰æ’è¡Œæ¦œ
            listenRank();
        };
    </script>
</body>

</html>